/*! For license information please see main.bf5a1877.js.LICENSE.txt */
(()=>{var e={356:(e,t,r)=>{e.exports=r(9645).last},579:(e,t,r)=>{"use strict";e.exports=r(1153)},870:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObject=function(e){return null!==e&&("object"===typeof e||"function"===typeof e)}},1153:(e,t,r)=>{"use strict";var n=r(5043),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,i={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,n)&&!s.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:a,type:e,key:c,ref:u,props:i,_owner:l.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},1203:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(8420);t.isArrayLike=function(e){return null!=e&&"function"!==typeof e&&n.isLength(e.length)}},1293:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(4830);t.debounce=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"!==typeof r&&(r={});const{leading:a=!1,trailing:i=!0,maxWait:o}=r,l=Array(2);let s;a&&(l[0]="leading"),i&&(l[1]="trailing");let c=null;const u=n.debounce(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];s=e.apply(this,r),c=null},t,{edges:l}),d=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return null!=o&&(null===c&&(c=Date.now()),Date.now()-c>=o)?(s=e.apply(this,r),c=Date.now(),u.cancel(),u.schedule(),s):(u.apply(this,r),s)};return d.cancel=u.cancel,d.flush=()=>(u.flush(),s),d}},1444:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toPath=function(e){const t=[],r=e.length;if(0===r)return t;let n=0,a="",i="",o=!1;for(46===e.charCodeAt(0)&&(t.push(""),n++);n<r;){const l=e[n];i?"\\"===l&&n+1<r?(n++,a+=e[n]):l===i?i="":a+=l:o?'"'===l||"'"===l?i=l:"]"===l?(o=!1,t.push(a),a=""):a+=l:"["===l?(o=!0,a&&(t.push(a),a="")):"."===l?a&&(t.push(a),a=""):a+=l,n++}return a&&t.push(a),t}},2086:(e,t,r)=>{"use strict";e.exports=r(5082)},2104:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(1203),a=r(9921);t.isArrayLikeObject=function(e){return a.isObjectLike(e)&&n.isArrayLike(e)}},2132:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(8268),a=r(870),i=r(4803),o=r(9972);function l(e,t,r,n){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,r,n){if(null==t)return!0;if(Array.isArray(t))return s(e,t,r,n);if(t instanceof Map)return function(e,t,r,n){if(0===t.size)return!0;if(!(e instanceof Map))return!1;for(const[a,i]of t.entries()){if(!1===r(e.get(a),i,a,e,t,n))return!1}return!0}(e,t,r,n);if(t instanceof Set)return c(e,t,r,n);const a=Object.keys(t);if(null==e)return 0===a.length;if(0===a.length)return!0;if(n&&n.has(t))return n.get(t)===e;n&&n.set(t,e);try{for(let o=0;o<a.length;o++){const l=a[o];if(!i.isPrimitive(e)&&!(l in e))return!1;if(void 0===t[l]&&void 0!==e[l])return!1;if(null===t[l]&&null!==e[l])return!1;if(!r(e[l],t[l],l,e,t,n))return!1}return!0}finally{n&&n.delete(t)}}(e,t,r,n);case"function":return Object.keys(t).length>0?l(e,{...t},r,n):o.eq(e,t);default:return a.isObject(e)?"string"!==typeof t||""===t:o.eq(e,t)}}function s(e,t,r,n){if(0===t.length)return!0;if(!Array.isArray(e))return!1;const a=new Set;for(let i=0;i<t.length;i++){const o=t[i];let l=!1;for(let s=0;s<e.length;s++){if(a.has(s))continue;let c=!1;if(r(e[s],o,i,e,t,n)&&(c=!0),c){a.add(s),l=!0;break}}if(!l)return!1}return!0}function c(e,t,r,n){return 0===t.size||e instanceof Set&&s([...e],[...t],r,n)}t.isMatchWith=function(e,t,r){return"function"!==typeof r?n.isMatch(e,t):l(e,t,function e(t,n,a,i,o,s){const c=r(t,n,a,i,o,s);return void 0!==c?Boolean(c):l(t,n,e,s)},new Map)},t.isSetMatch=c},2204:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(5316),a=r(7312),i=r(3799);t.sortBy=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];const l=r.length;return l>1&&i.isIterateeCall(e,r[0],r[1])?r=[]:l>2&&i.isIterateeCall(r[0],r[1],r[2])&&(r=[r[0]]),n.orderBy(e,a.flatten(r),["asc"])}},2330:(e,t,r)=>{"use strict";var n=r(5043);var a="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},i=n.useState,o=n.useEffect,l=n.useLayoutEffect,s=n.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(n){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=i({inst:{value:r,getSnapshot:t}}),a=n[0].inst,u=n[1];return l(function(){a.value=r,a.getSnapshot=t,c(a)&&u({inst:a})},[e,r,t]),o(function(){return c(a)&&u({inst:a}),e(function(){c(a)&&u({inst:a})})},[e]),s(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:u},2489:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},2682:(e,t)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPlainObject=function(e){if("object"!==typeof e)return!1;if(null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){const t=e[Symbol.toStringTag];if(null==t)return!1;return!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},2715:(e,t,r)=>{"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(9599),a=r(7330),i=r(3808),o=r(8845);t.iteratee=function(e){if(null==e)return n.identity;switch(typeof e){case"function":return e;case"object":return Array.isArray(e)&&2===e.length?o.matchesProperty(e[0],e[1]):i.matches(e);case"string":case"symbol":case"number":return a.property(e)}}},2730:(e,t,r)=>{"use strict";var n=r(5043),a=r(8853);function i(e){for(var t="https://55ed7072-61d8-4f88-bd36-e45dc24a0e7f.preview.emergentagent.com",n=await fetch(`${t}/api/dashboard`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error("Erreur lors du chargement des statistiques");const a=await n.json();r(a)}catch(o){console.error("Erreur:",o),l(o.message)}finally{i(!1)}};if(n)return(0,Gt.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(o)return(0,Gt.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,Gt.jsxs)("div",{className:"text-center",children:[(0,Gt.jsx)(KO,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,Gt.jsx)("p",{className:"text-red-600 dark:text-red-400",children:o}),(0,Gt.jsx)("button",{onClick:m,className:"mt-4 btn-primary",children:"R\xe9essayer"})]})});if(!t)return null;const y=[{name:"Ouverts",value:t.tickets.ouverts,color:d},{name:"Clotur\xe9s",value:t.tickets.clotures,color:u}],g=[{name:"Ouvertes",value:t.portabilites.ouvertes,color:p},{name:"Termin\xe9es",value:t.portabilites.terminees,color:u},{name:"En erreur",value:t.portabilites.erreur,color:f}],v=Object.entries(t.tickets.byStatus).map(e=>{let[t,r]=e;return{status:t.replace("_"," ").toUpperCase(),count:r}}),b=Object.entries(t.portabilites.byStatus).map(e=>{let[t,r]=e;return{status:t.replace("_"," ").toUpperCase(),count:r}}),x=e=>{let{active:t,payload:r,label:n}=e;return t&&r&&r.length?(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface p-3 border border-gray-200 dark:border-dark-border rounded-lg shadow-lg",children:(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-dark-text font-medium",children:`${n}: ${r[0].value}`})}):null};return(0,Gt.jsxs)("div",{className:"space-y-6",children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Dashboard"}),(0,Gt.jsxs)("p",{className:"text-gray-600 dark:text-dark-text-secondary",children:["Vue d'ensemble de votre activit\xe9 ",s?"(Vue Agent)":"(Vue Demandeur)"]})]}),(0,Gt.jsxs)("button",{onClick:m,className:"btn-primary flex items-center",children:[(0,Gt.jsx)(HO,{className:"h-4 w-4 mr-2"}),"Actualiser"]})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)(VO,{className:"h-8 w-8 text-yellow-500"})}),(0,Gt.jsxs)("div",{className:"ml-4",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-dark-text-secondary",children:"Tickets Ouverts"}),(0,Gt.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:t.tickets.ouverts})]})]})}),(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)(YO,{className:"h-8 w-8 text-green-500"})}),(0,Gt.jsxs)("div",{className:"ml-4",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-dark-text-secondary",children:"Tickets Clotur\xe9s"}),(0,Gt.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:t.tickets.clotures})]})]})}),(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)(ar,{className:"h-8 w-8 text-blue-500"})}),(0,Gt.jsxs)("div",{className:"ml-4",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-dark-text-secondary",children:"Portabilit\xe9s Ouvertes"}),(0,Gt.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:t.portabilites.ouvertes})]})]})}),(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)(KO,{className:"h-8 w-8 text-red-500"})}),(0,Gt.jsxs)("div",{className:"ml-4",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-dark-text-secondary",children:"Portabilit\xe9s en Erreur"}),(0,Gt.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:t.portabilites.erreur})]})]})})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"R\xe9partition des Tickets"}),t.tickets.total>0?(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(Yv,{children:[(0,Gt.jsx)(Fk,{data:y,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:e=>{let{name:t,value:r}=e;return`${t}: ${r}`},children:y.map((e,t)=>(0,Gt.jsx)(Ux,{fill:e.color},`cell-${t}`))}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})})]})}):(0,Gt.jsx)("div",{className:"h-[300px] flex items-center justify-center text-gray-500 dark:text-dark-text-secondary",children:"Aucun ticket"})]}),(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"R\xe9partition des Portabilit\xe9s"}),t.portabilites.total>0?(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(Yv,{children:[(0,Gt.jsx)(Fk,{data:g,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:e=>{let{name:t,value:r}=e;return`${t}: ${r}`},children:g.map((e,t)=>(0,Gt.jsx)(Ux,{fill:e.color},`cell-${t}`))}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})})]})}):(0,Gt.jsx)("div",{className:"h-[300px] flex items-center justify-center text-gray-500 dark:text-dark-text-secondary",children:"Aucune portabilit\xe9"})]})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"Tickets par Statut"}),v.length>0?(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(Tj,{data:v,children:[(0,Gt.jsx)(OS,{strokeDasharray:"3 3"}),(0,Gt.jsx)(IS,{dataKey:"status",angle:-45,textAnchor:"end",height:80,className:"text-xs"}),(0,Gt.jsx)(WS,{}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})}),(0,Gt.jsx)(cO,{dataKey:"count",fill:c})]})}):(0,Gt.jsx)("div",{className:"h-[300px] flex items-center justify-center text-gray-500 dark:text-dark-text-secondary",children:"Aucune donn\xe9e"})]}),(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"Portabilit\xe9s par Statut"}),b.length>0?(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(Tj,{data:b,children:[(0,Gt.jsx)(OS,{strokeDasharray:"3 3"}),(0,Gt.jsx)(IS,{dataKey:"status",angle:-45,textAnchor:"end",height:80,className:"text-xs"}),(0,Gt.jsx)(WS,{}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})}),(0,Gt.jsx)(cO,{dataKey:"count",fill:p})]})}):(0,Gt.jsx)("div",{className:"h-[300px] flex items-center justify-center text-gray-500 dark:text-dark-text-secondary",children:"Aucune donn\xe9e"})]})]}),s&&t.additional&&(0,Gt.jsxs)("div",{className:"space-y-6",children:[t.additional.evolutionTickets&&t.additional.evolutionTickets.length>0&&(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"\xc9volution des Tickets (7 derniers jours)"}),(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(dO,{data:t.additional.evolutionTickets,children:[(0,Gt.jsx)(OS,{strokeDasharray:"3 3"}),(0,Gt.jsx)(IS,{dataKey:"date"}),(0,Gt.jsx)(WS,{}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})}),(0,Gt.jsx)(qO,{type:"monotone",dataKey:"count",stroke:c,strokeWidth:2})]})})]}),t.additional.topClients&&t.additional.topClients.length>0&&(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"Top 5 Clients (par nombre de tickets)"}),(0,Gt.jsx)(Hr,{width:"100%",height:300,children:(0,Gt.jsxs)(Tj,{data:t.additional.topClients,layout:"horizontal",children:[(0,Gt.jsx)(OS,{strokeDasharray:"3 3"}),(0,Gt.jsx)(IS,{type:"number"}),(0,Gt.jsx)(WS,{dataKey:"nom",type:"category",width:150}),(0,Gt.jsx)(Oj,{content:(0,Gt.jsx)(x,{})}),(0,Gt.jsx)(cO,{dataKey:"tickets",fill:h})]})})]}),t.additional.parSociete&&t.additional.parSociete.length>0&&(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow p-6 border border-gray-200 dark:border-dark-border",children:[(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-4",children:"R\xe9partition par Soci\xe9t\xe9"}),(0,Gt.jsx)("div",{className:"overflow-x-auto",children:(0,Gt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-dark-border",children:[(0,Gt.jsx)("thead",{className:"bg-gray-50 dark:bg-dark-bg",children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider",children:"Soci\xe9t\xe9"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider",children:"Demandeurs"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider",children:"Tickets"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider",children:"Portabilit\xe9s"})]})}),(0,Gt.jsx)("tbody",{className:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border",children:t.additional.parSociete.map((e,t)=>(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-dark-text",children:e.societe}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-secondary",children:e.demandeurs}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-secondary",children:e.tickets}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-dark-text-secondary",children:e.portabilites})]},t))})]})})]})]})]})},XO=rr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),QO=rr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),JO=rr("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),ZO=rr("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),eE=rr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),tE=rr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),rE=rr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),nE=rr("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),aE=()=>{const{api:e}=Qt(),[t,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(!0),[o,l]=(0,a.useState)(!1),[s,c]=(0,a.useState)(!0),[u,d]=(0,a.useState)(""),[f,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[y,g]=(0,a.useState)(""),[v,b]=(0,a.useState)(""),[x,w]=(0,a.useState)(!1),[k,j]=(0,a.useState)(1),[S,N]=(0,a.useState)({page:1,limit:10,total:0,totalPages:0,hasNext:!1,hasPrev:!1}),[O,E]=(0,a.useState)({nom_societe:"",adresse:"",nom:"",prenom:"",numero:""});(0,a.useEffect)(()=>{P()},[k,v]),(0,a.useEffect)(()=>{y.length>=3&&w(!0);const e=setTimeout(()=>{(y.length>=3||0===y.length)&&(b(y),1!==k&&j(1)),w(!1)},1e3);return()=>{clearTimeout(e),w(!1)}},[y,k]),(0,a.useEffect)(()=>{1!==k&&v&&j(1)},[v]);const P=async()=>{try{s?i(!0):l(!0);const t=new URLSearchParams({page:k.toString(),limit:"10"});v.trim()&&t.append("search",v.trim());const n=await e.get(`/api/clients?${t}`);n.data.data&&n.data.pagination?(r(n.data.data),N(n.data.pagination)):(r(n.data),N({page:1,limit:n.data.length,total:n.data.length,totalPages:1,hasNext:!1,hasPrev:!1}))}catch(u){d("Erreur lors du chargement des clients"),console.error("Error fetching clients:",u)}finally{s?(i(!1),c(!1)):l(!1)}},_=e=>{e>=1&&e<=S.totalPages&&j(e)},C=()=>{p(!1),m(null),E({nom_societe:"",adresse:"",nom:"",prenom:"",numero:""}),d("")};return n?(0,Gt.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg p-6",children:(0,Gt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,Gt.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),(0,Gt.jsx)("span",{className:"ml-3 text-lg text-gray-600 dark:text-gray-400",children:"Chargement des clients..."})]})})}):(0,Gt.jsx)("div",{className:"fade-in",children:(0,Gt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Gt.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Gestion des Clients"}),(0,Gt.jsxs)("button",{onClick:()=>p(!0),className:"btn-primary flex items-center",children:[(0,Gt.jsx)(XO,{className:"h-5 w-5 mr-2"}),"Nouveau Client"]})]}),(0,Gt.jsxs)("div",{className:"mb-6",children:[(0,Gt.jsxs)("div",{className:"relative max-w-md",children:[(0,Gt.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,Gt.jsx)(QO,{className:"h-5 w-5 text-gray-400"})}),(0,Gt.jsx)("input",{type:"text",placeholder:"Rechercher un client (min. 3 caract\xe8res)...",value:y,onChange:e=>{g(e.target.value)},className:"input pl-10 pr-10 w-full"}),x&&(0,Gt.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"})})]}),y&&y.length>0&&y.length<3&&(0,Gt.jsx)("p",{className:"text-sm text-orange-500 dark:text-orange-400 mt-2",children:"Tapez au moins 3 caract\xe8res pour rechercher"}),v&&(0,Gt.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[S.total," r\xe9sultat",S.total>1?"s":"",' pour "',v,'"']})]}),u&&(0,Gt.jsx)("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(yr,{className:"h-5 w-5 text-red-500 mr-2"}),(0,Gt.jsx)("span",{className:"text-red-700 dark:text-red-400",children:u})]})}),(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-sm overflow-hidden",children:[o?(0,Gt.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,Gt.jsxs)("div",{className:"text-center",children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),(0,Gt.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:v?`Recherche en cours pour "${v}"...`:"Chargement des clients..."})]})}):(0,Gt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-dark-border",children:[(0,Gt.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Soci\xe9t\xe9"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Contact"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"T\xe9l\xe9phone"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Adresse"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,Gt.jsx)("tbody",{className:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-dark-border",children:t.map(t=>(0,Gt.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-dark-card",children:[(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(JO,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-3"}),(0,Gt.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-dark-text",children:t.nom_societe})]})}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-dark-text",children:t.prenom||t.nom?`${t.prenom||""} ${t.nom||""}`.trim():"-"}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-dark-text",children:t.numero||"-"}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-dark-text",children:t.adresse}),(0,Gt.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{m(e),E({nom_societe:e.nom_societe,adresse:e.adresse,nom:e.nom||"",prenom:e.prenom||"",numero:e.numero||""}),p(!0)})(t),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 mr-3",children:(0,Gt.jsx)(ZO,{className:"h-4 w-4"})}),(0,Gt.jsx)("button",{onClick:()=>(async t=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce client ?"))try{await e.delete(`/api/clients/${t}`),await P()}catch(u){var r,n;d((null===(r=u.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la suppression")}})(t.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:(0,Gt.jsx)(eE,{className:"h-4 w-4"})})]})]},t.id))})]}),!o&&0===t.length&&(0,Gt.jsx)("div",{className:"p-8 text-center text-gray-500 dark:text-dark-muted",children:v?`Aucun client trouv\xe9 pour "${v}"`:"Aucun client enregistr\xe9"})]}),S.totalPages>1&&(0,Gt.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,Gt.jsx)("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:(0,Gt.jsxs)("span",{children:["Affichage de ",(S.page-1)*S.limit+1," \xe0"," ",Math.min(S.page*S.limit,S.total)," sur"," ",S.total," clients"]})}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsxs)("button",{onClick:()=>_(S.page-1),disabled:!S.hasPrev,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-500 bg-white dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-md hover:bg-gray-50 dark:hover:bg-dark-card disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white dark:disabled:hover:bg-dark-surface",children:[(0,Gt.jsx)(tE,{className:"h-4 w-4 mr-1"}),"Pr\xe9c\xe9dent"]}),(0,Gt.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,S.totalPages)},(e,t)=>{let r;return r=S.totalPages<=5||S.page<=3?t+1:S.page>=S.totalPages-2?S.totalPages-4+t:S.page-2+t,(0,Gt.jsx)("button",{onClick:()=>_(r),className:"px-3 py-2 text-sm font-medium rounded-md "+(r===S.page?"bg-primary-600 text-white":"text-gray-500 bg-white dark:bg-dark-surface border border-gray-300 dark:border-dark-border hover:bg-gray-50 dark:hover:bg-dark-card"),children:r},r)})}),(0,Gt.jsxs)("button",{onClick:()=>_(S.page+1),disabled:!S.hasNext,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-500 bg-white dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-md hover:bg-gray-50 dark:hover:bg-dark-card disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-white dark:disabled:hover:bg-dark-surface",children:["Suivant",(0,Gt.jsx)(rE,{className:"h-4 w-4 ml-1"})]})]})]}),f&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-md modal-content",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:h?"Modifier le Client":"Nouveau Client"}),(0,Gt.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{h?await e.put(`/api/clients/${h.id}`,O):await e.post("/api/clients",O),await P(),C()}catch(u){var r,n;d((null===(r=u.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la sauvegarde")}},className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Nom de la soci\xe9t\xe9 *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:O.nom_societe,onChange:e=>E({...O,nom_societe:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Adresse *"}),(0,Gt.jsx)("textarea",{required:!0,value:O.adresse,onChange:e=>E({...O,adresse:e.target.value}),className:"input h-20 resize-none"})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Nom"}),(0,Gt.jsx)("input",{type:"text",value:O.nom,onChange:e=>E({...O,nom:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Pr\xe9nom"}),(0,Gt.jsx)("input",{type:"text",value:O.prenom,onChange:e=>E({...O,prenom:e.target.value}),className:"input"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Num\xe9ro de t\xe9l\xe9phone"}),(0,Gt.jsx)("input",{type:"tel",value:O.numero,onChange:e=>E({...O,numero:e.target.value}),className:"input",placeholder:"Ex: 01 23 45 67 89"})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:C,className:"btn-secondary",children:"Annuler"}),(0,Gt.jsxs)("button",{type:"submit",className:"btn-primary flex items-center",children:[(0,Gt.jsx)(nE,{className:"h-4 w-4 mr-2"}),h?"Modifier":"Cr\xe9er"]})]})]})]})})]})})},iE=rr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),oE=rr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),lE=e=>{let{options:t=[],value:r,onChange:n,placeholder:i="Rechercher...",className:o="",displayKey:l="label",valueKey:s="value",searchKeys:c=["label"],emptyMessage:u="Aucun r\xe9sultat trouv\xe9",hasError:d=!1}=e;const[f,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(""),[y,g]=(0,a.useState)(t),v=(0,a.useRef)(null),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(h){const e=t.filter(e=>c.some(t=>{var r;return null===(r=e[t])||void 0===r?void 0:r.toLowerCase().includes(h.toLowerCase())}));g(e)}else g(t)},[h,t,c]),(0,a.useEffect)(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&p(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{f&&b.current&&b.current.focus()},[f]);const x=t.find(e=>e[s]===r),w=x?x[l]:"";return(0,Gt.jsxs)("div",{ref:v,className:`relative ${o}`,children:[(0,Gt.jsxs)("div",{onClick:()=>p(!f),className:"cursor-pointer flex items-center justify-between min-h-[42px] w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(d?"border-red-500":"border-gray-300"),children:[(0,Gt.jsx)("span",{className:"flex-1 truncate "+(w?"":"text-gray-500 dark:text-gray-400"),children:w||i}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-1",children:[r&&(0,Gt.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),n(""),m("")},className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded",children:(0,Gt.jsx)(cr,{className:"h-4 w-4 text-gray-400"})}),(0,Gt.jsx)(oE,{className:"h-4 w-4 text-gray-400 transition-transform "+(f?"rotate-180":"")})]})]}),f&&(0,Gt.jsxs)("div",{className:"absolute z-50 w-full mt-1 bg-white dark:bg-dark-surface border border-gray-300 dark:border-dark-border rounded-lg shadow-lg max-h-60 overflow-hidden",children:[(0,Gt.jsx)("div",{className:"p-3 border-b border-gray-200 dark:border-dark-border",children:(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)(QO,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,Gt.jsx)("input",{ref:b,type:"text",value:h,onChange:e=>m(e.target.value),placeholder:"Rechercher...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-dark-border rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text text-sm"})]})}),(0,Gt.jsx)("div",{className:"max-h-40 overflow-y-auto",children:y.length>0?y.map((e,t)=>(0,Gt.jsxs)("div",{onClick:()=>(e=>{n(e[s]),p(!1),m("")})(e),className:"px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-card transition-colors "+(e[s]===r?"bg-primary-50 dark:bg-primary-900/20 text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-dark-text"),children:[(0,Gt.jsx)("div",{className:"font-medium",children:e[l]}),e.subtitle&&(0,Gt.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.subtitle})]},`${e[s]}-${t}`)):(0,Gt.jsx)("div",{className:"px-3 py-4 text-center text-gray-500 dark:text-gray-400 text-sm",children:u})})]})]})},sE=()=>{const{api:e,user:t}=Qt(),[r,n]=(0,a.useState)("demandeurs"),[i,o]=(0,a.useState)([]),[l,s]=(0,a.useState)([]),[c,u]=(0,a.useState)(!0),[d,f]=(0,a.useState)(""),[p,h]=(0,a.useState)(!1),[m,y]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),[b,x]=(0,a.useState)(null),[w,k]=(0,a.useState)(null),[j,S]=(0,a.useState)(null),[N,O]=(0,a.useState)(null),[E,P]=(0,a.useState)(""),[_,C]=(0,a.useState)(!1),[A,T]=(0,a.useState)(""),[M,D]=(0,a.useState)(!1),[I,R]=(0,a.useState)({nom:"",prenom:"",societe:"",societe_id:"",telephone:"",email:"",password:""}),[L,z]=(0,a.useState)({nom_societe:"",siret:"",adresse:"",adresse_complement:"",code_postal:"",ville:"",numero_tel:"",email:"",logo_base64:""}),F="agent"===(null===t||void 0===t?void 0:t.type_utilisateur);(0,a.useEffect)(()=>{U(),F&&B()},[]);const U=async()=>{try{const t=await e.get("/api/demandeurs");o(t.data)}catch(d){f("Erreur lors du chargement des demandeurs")}finally{u(!1)}},B=async()=>{try{const t=await e.get("/api/demandeurs-societe");s(t.data.data||t.data)}catch(d){f("Erreur lors du chargement des soci\xe9t\xe9s")}},$=()=>{h(!1),x(null);const e={nom:"",prenom:"",societe:"",societe_id:"",telephone:"",email:"",password:""};if(!F&&i.length>0){const r=i.find(e=>e.email===t.email);r&&(e.societe=r.societe_nom||r.societe,e.societe_id=r.societe_id)}R(e),f("")},W=()=>{y(!1),k(null),z({nom_societe:"",siret:"",adresse:"",adresse_complement:"",code_postal:"",ville:"",numero_tel:"",email:"",logo_base64:""}),T(""),f("")},q=l.map(e=>({value:e.id,label:e.nom_societe,subtitle:`${e.ville} - ${e.siret||"Pas de SIRET"}`}));return c?(0,Gt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,Gt.jsxs)("div",{className:"fade-in",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Gt.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:F?"Gestion des Demandeurs":"Mes Collaborateurs"}),(0,Gt.jsxs)("div",{className:"flex space-x-3",children:[F&&(0,Gt.jsxs)("button",{onClick:()=>y(!0),className:"btn-secondary flex items-center",children:[(0,Gt.jsx)(JO,{className:"h-5 w-5 mr-2"}),"Nouvelle Soci\xe9t\xe9"]}),(0,Gt.jsxs)("button",{onClick:()=>{if(!F&&i.length>0){const e=i.find(e=>e.email===t.email);e&&R({nom:"",prenom:"",societe:e.societe_nom||e.societe,societe_id:e.societe_id||"",telephone:"",email:"",password:""})}h(!0)},className:"btn-primary flex items-center",children:[(0,Gt.jsx)(XO,{className:"h-5 w-5 mr-2"}),"Nouveau Demandeur"]})]})]}),F&&(0,Gt.jsx)("div",{className:"mb-6",children:(0,Gt.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,Gt.jsxs)("nav",{className:"flex space-x-8",children:[(0,Gt.jsxs)("button",{onClick:()=>n("demandeurs"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("demandeurs"===r?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:["Demandeurs (",i.length,")"]}),(0,Gt.jsxs)("button",{onClick:()=>n("societes"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("societes"===r?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:["Soci\xe9t\xe9s (",l.length,")"]})]})})}),d&&(0,Gt.jsxs)("div",{className:"mb-4 flex items-center p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,Gt.jsx)(yr,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-3"}),(0,Gt.jsx)("span",{className:"text-red-700 dark:text-red-300",children:d})]}),(!F||"demandeurs"===r)&&(0,Gt.jsxs)("div",{className:"card overflow-hidden",children:[(0,Gt.jsxs)("table",{className:"table",children:[(0,Gt.jsx)("thead",{children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{children:"Nom"}),(0,Gt.jsx)("th",{children:"Email"}),(0,Gt.jsx)("th",{children:"Soci\xe9t\xe9"}),(0,Gt.jsx)("th",{children:"T\xe9l\xe9phone"}),(0,Gt.jsx)("th",{children:"Actions"})]})}),(0,Gt.jsx)("tbody",{children:i.map(t=>(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(lr,{className:"h-5 w-5 text-primary-600 mr-2"}),(0,Gt.jsxs)("span",{className:"font-medium",children:[t.prenom," ",t.nom]})]})}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(gr,{className:"h-4 w-4 text-gray-400 mr-2"}),t.email]})}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(JO,{className:"h-4 w-4 text-gray-400 mr-2"}),t.societe_nom||t.societe]})}),(0,Gt.jsx)("td",{children:t.telephone&&(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(ir,{className:"h-4 w-4 text-gray-400 mr-2"}),t.telephone]})}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex space-x-2",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{x(e),R({nom:e.nom,prenom:e.prenom,societe:e.societe,societe_id:e.societe_id||"",telephone:e.telephone||"",email:e.email,password:""}),h(!0)})(t),className:"p-2 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",children:(0,Gt.jsx)(ZO,{className:"h-4 w-4"})}),(0,Gt.jsx)("button",{onClick:()=>(async t=>{try{if(!1===(await e.delete(`/api/demandeurs/${t}`)).data.transferred)return void U()}catch(d){var r;if(409===(null===(r=d.response)||void 0===r?void 0:r.status)){const r=d.response.data;S(t),O(r),P(""),v(!0)}else{var n,a;f((null===(n=d.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.detail)||"Erreur lors de la suppression")}}})(t.id),className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,Gt.jsx)(eE,{className:"h-4 w-4"})})]})})]},t.id))})]}),0===i.length&&(0,Gt.jsx)("div",{className:"p-8 text-center text-gray-500 dark:text-dark-muted",children:F?"Aucun demandeur enregistr\xe9":"Aucun collaborateur dans votre soci\xe9t\xe9"})]}),F&&"societes"===r&&(0,Gt.jsxs)("div",{className:"card overflow-hidden",children:[(0,Gt.jsxs)("table",{className:"table",children:[(0,Gt.jsx)("thead",{children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{children:"Logo"}),(0,Gt.jsx)("th",{children:"Soci\xe9t\xe9"}),(0,Gt.jsx)("th",{children:"SIRET"}),(0,Gt.jsx)("th",{children:"Ville"}),(0,Gt.jsx)("th",{children:"Email"}),(0,Gt.jsx)("th",{children:"T\xe9l\xe9phone"}),(0,Gt.jsx)("th",{children:"Actions"})]})}),(0,Gt.jsx)("tbody",{children:l.map(t=>(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("td",{children:(0,Gt.jsx)("div",{className:"flex items-center",children:t.logo_base64?(0,Gt.jsx)("img",{src:`data:image/jpeg;base64,${t.logo_base64}`,alt:"Logo",className:"h-10 w-10 rounded-full object-cover"}):(0,Gt.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:(0,Gt.jsx)(JO,{className:"h-5 w-5 text-gray-400"})})})}),(0,Gt.jsxs)("td",{children:[(0,Gt.jsx)("div",{className:"font-medium",children:t.nom_societe}),(0,Gt.jsx)("div",{className:"text-sm text-gray-500",children:t.adresse})]}),(0,Gt.jsx)("td",{children:t.siret||"-"}),(0,Gt.jsx)("td",{children:t.ville}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(gr,{className:"h-4 w-4 text-gray-400 mr-2"}),t.email]})}),(0,Gt.jsx)("td",{children:t.numero_tel&&(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(ir,{className:"h-4 w-4 text-gray-400 mr-2"}),t.numero_tel]})}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex space-x-2",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{k(e),z({nom_societe:e.nom_societe,siret:e.siret||"",adresse:e.adresse,adresse_complement:e.adresse_complement||"",code_postal:e.code_postal,ville:e.ville,numero_tel:e.numero_tel||"",email:e.email,logo_base64:e.logo_base64||""}),y(!0)})(t),className:"p-2 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",children:(0,Gt.jsx)(ZO,{className:"h-4 w-4"})}),(0,Gt.jsx)("button",{onClick:()=>(async t=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette soci\xe9t\xe9 ?"))try{await e.delete(`/api/demandeurs-societe/${t}`),B()}catch(d){var r,n;f((null===(r=d.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la suppression")}})(t.id),className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,Gt.jsx)(eE,{className:"h-4 w-4"})})]})})]},t.id))})]}),0===l.length&&(0,Gt.jsx)("div",{className:"p-8 text-center text-gray-500 dark:text-dark-muted",children:"Aucune soci\xe9t\xe9 enregistr\xe9e"})]}),p&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-md modal-content",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:b?"Modifier le Demandeur":"Nouveau Demandeur"}),(0,Gt.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{let t={...I};b&&delete t.password,b?await e.put(`/api/demandeurs/${b.id}`,t):await e.post("/api/demandeurs",t),U(),$()}catch(d){var r,n;f((null===(r=d.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la sauvegarde")}},className:"space-y-4",children:[(0,Gt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Nom *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:I.nom,onChange:e=>R({...I,nom:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Pr\xe9nom *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:I.prenom,onChange:e=>R({...I,prenom:e.target.value}),className:"input"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Soci\xe9t\xe9 *"}),F&&l.length>0?(0,Gt.jsx)(lE,{options:q,value:I.societe_id,onChange:e=>{const t=l.find(t=>t.id===e);R({...I,societe_id:e,societe:t?t.nom_societe:""})},placeholder:"S\xe9lectionner une soci\xe9t\xe9...",className:"w-full"}):(0,Gt.jsx)("input",{type:"text",required:!0,value:I.societe,onChange:e=>R({...I,societe:e.target.value}),className:"input",placeholder:"Nom de la soci\xe9t\xe9",readOnly:!F})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"T\xe9l\xe9phone"}),(0,Gt.jsx)("input",{type:"tel",value:I.telephone,onChange:e=>R({...I,telephone:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Email *"}),(0,Gt.jsx)("input",{type:"email",required:!0,value:I.email,onChange:e=>R({...I,email:e.target.value}),className:"input"})]}),!b&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Mot de passe *"}),(0,Gt.jsx)("input",{type:"password",required:!0,value:I.password,onChange:e=>R({...I,password:e.target.value}),className:"input",placeholder:"Mot de passe"})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:$,className:"btn-secondary",children:"Annuler"}),(0,Gt.jsxs)("button",{type:"submit",className:"btn-primary flex items-center",children:[(0,Gt.jsx)(nE,{className:"h-4 w-4 mr-2"}),b?"Modifier":"Cr\xe9er"]})]})]})]})}),m&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-2xl modal-content max-h-90vh overflow-y-auto",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:w?"Modifier la Soci\xe9t\xe9":"Nouvelle Soci\xe9t\xe9"}),(0,Gt.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{w?await e.put(`/api/demandeurs-societe/${w.id}`,L):await e.post("/api/demandeurs-societe",L),B(),W()}catch(d){var r,n;f((null===(r=d.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la sauvegarde")}},className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"SIRET"}),(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("input",{type:"text",value:L.siret,onChange:t=>{const r=t.target.value.replace(/\D/g,"");z({...L,siret:r}),14===r.length&&(async t=>{if(t&&14===t.length){C(!0),T("");try{const r=(await e.get(`/api/insee-api?siret=${t}`)).data;r&&r.siret?(z(e=>{var t,n,a;return{...e,nom_societe:r.denomination||e.nom_societe,adresse:(null===(t=r.adresse)||void 0===t?void 0:t.adresseComplete)||e.adresse,code_postal:(null===(n=r.adresse)||void 0===n?void 0:n.codePostal)||e.code_postal,ville:(null===(a=r.adresse)||void 0===a?void 0:a.commune)||e.ville}}),T("")):T("Aucune information trouv\xe9e pour ce SIRET")}catch(d){console.error("Erreur SIRET lookup:",d),T("Erreur lors de la recherche SIRET. V\xe9rifiez le num\xe9ro.")}finally{C(!1)}}})(r)},className:"input pr-10",placeholder:"Ex: 12345678901234",maxLength:"14"}),_&&(0,Gt.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"})})]}),A&&(0,Gt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:A})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Nom de la soci\xe9t\xe9 *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:L.nom_societe,onChange:e=>z({...L,nom_societe:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Adresse *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:L.adresse,onChange:e=>z({...L,adresse:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Compl\xe9ment d'adresse"}),(0,Gt.jsx)("input",{type:"text",value:L.adresse_complement,onChange:e=>z({...L,adresse_complement:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Code postal *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:L.code_postal,onChange:e=>z({...L,code_postal:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Ville *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:L.ville,onChange:e=>z({...L,ville:e.target.value}),className:"input"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Num\xe9ro de t\xe9l\xe9phone"}),(0,Gt.jsx)("input",{type:"tel",value:L.numero_tel,onChange:e=>z({...L,numero_tel:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Email *"}),(0,Gt.jsx)("input",{type:"email",required:!0,value:L.email,onChange:e=>z({...L,email:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Logo de la soci\xe9t\xe9"}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Gt.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];if(!t)return;if(t.size>2097152)return void f("Logo trop volumineux (limite: 2MB)");if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))return void f("Format d'image non autoris\xe9. Utilisez JPG, PNG, GIF ou WebP.");const r=new FileReader;r.onload=e=>{z(t=>({...t,logo_base64:e.target.result.split(",")[1]}))},r.readAsDataURL(t)},className:"hidden",id:"logo-upload"}),(0,Gt.jsxs)("label",{htmlFor:"logo-upload",className:"flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600",children:[(0,Gt.jsx)(iE,{className:"h-4 w-4 mr-2"}),"Choisir un logo"]}),L.logo_base64&&(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsx)("img",{src:`data:image/jpeg;base64,${L.logo_base64}`,alt:"Logo",className:"h-8 w-8 rounded object-cover"}),(0,Gt.jsx)("button",{type:"button",onClick:()=>z({...L,logo_base64:""}),className:"text-red-500 hover:text-red-700",children:"Supprimer"})]})]}),(0,Gt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Formats accept\xe9s: JPG, PNG, GIF, WebP \u2022 Taille max: 2MB"})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:W,className:"btn-secondary",children:"Annuler"}),(0,Gt.jsxs)("button",{type:"submit",className:"btn-primary flex items-center",disabled:_,children:[(0,Gt.jsx)(nE,{className:"h-4 w-4 mr-2"}),w?"Modifier":"Cr\xe9er"]})]})]})]})}),g&&N&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-2xl modal-content",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:"Transfert de donn\xe9es requis"}),(0,Gt.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,Gt.jsxs)("div",{className:"flex items-start",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,Gt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,Gt.jsxs)("div",{className:"ml-3",children:[(0,Gt.jsx)("h3",{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200",children:"Attention"}),(0,Gt.jsxs)("div",{className:"mt-2 text-sm text-yellow-700 dark:text-yellow-300",children:[(0,Gt.jsxs)("p",{children:["Le demandeur ",(0,Gt.jsxs)("strong",{children:[N.demandeur.prenom," ",N.demandeur.nom]})," (",N.demandeur.email,") a des donn\xe9es li\xe9es qui doivent \xeatre transf\xe9r\xe9es avant la suppression :"]}),(0,Gt.jsxs)("ul",{className:"mt-2 list-disc list-inside",children:[N.linkedData.tickets>0&&(0,Gt.jsxs)("li",{children:[N.linkedData.tickets," ticket",N.linkedData.tickets>1?"s":""]}),N.linkedData.portabilites>0&&(0,Gt.jsxs)("li",{children:[N.linkedData.portabilites," portabilit\xe9",N.linkedData.portabilites>1?"s":""]})]})]})]})]})}),N.canDelete?(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("div",{className:"mb-4",children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-2",children:"Transf\xe9rer vers le demandeur :"}),(0,Gt.jsxs)("select",{value:E,onChange:e=>P(e.target.value),className:"input w-full",required:!0,children:[(0,Gt.jsx)("option",{value:"",children:"S\xe9lectionner un demandeur..."}),N.otherDemandeurs.map(e=>(0,Gt.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," (",e.email,")"]},e.id))]})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Gt.jsx)("button",{onClick:()=>{v(!1),S(null),O(null),P("")},className:"btn-secondary",disabled:M,children:"Annuler"}),(0,Gt.jsx)("button",{onClick:async()=>{if(E&&j){D(!0);try{await e.delete(`/api/demandeurs/${j}`,{data:{transferTo:E}}),v(!1),S(null),O(null),P(""),U()}catch(d){var t,r;f((null===(t=d.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.detail)||"Erreur lors du transfert et suppression")}finally{D(!1)}}},disabled:!E||M,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:M?(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Transfert en cours..."]}):(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("svg",{className:"h-4 w-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Transf\xe9rer et Supprimer"]})})]})]}):(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,Gt.jsxs)("div",{className:"flex items-start",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,Gt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,Gt.jsxs)("div",{className:"ml-3",children:[(0,Gt.jsx)("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Suppression impossible"}),(0,Gt.jsxs)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:[(0,Gt.jsx)("p",{children:"Ce demandeur ne peut pas \xeatre supprim\xe9 car il n'y a aucun autre demandeur dans sa soci\xe9t\xe9 pour r\xe9cup\xe9rer ses tickets et portabilit\xe9s."}),(0,Gt.jsx)("p",{className:"mt-2",children:(0,Gt.jsx)("strong",{children:"Solutions :"})}),(0,Gt.jsxs)("ul",{className:"mt-1 list-disc list-inside",children:[(0,Gt.jsx)("li",{children:"Cr\xe9er un autre demandeur dans la m\xeame soci\xe9t\xe9"}),(0,Gt.jsx)("li",{children:"Ou transf\xe9rer le demandeur vers une autre soci\xe9t\xe9"})]})]})]})]})}),(0,Gt.jsx)("div",{className:"flex justify-end",children:(0,Gt.jsx)("button",{onClick:()=>{v(!1),S(null),O(null)},className:"btn-primary",children:"Fermer"})})]})]})})]})},cE=()=>{const{api:e}=Qt(),[t,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(!0),[o,l]=(0,a.useState)(""),[s,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(null),[f,p]=(0,a.useState)({nom:"",prenom:"",societe:"",email:"",password:""});(0,a.useEffect)(()=>{h()},[]);const h=async()=>{try{const t=await e.get("/api/agents");r(t.data)}catch(o){l("Erreur lors du chargement des agents")}finally{i(!1)}},m=()=>{c(!1),d(null),p({nom:"",prenom:"",societe:"",email:"",password:""}),l("")};return n?(0,Gt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,Gt.jsxs)("div",{className:"fade-in",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Gt.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Gestion des Agents"}),(0,Gt.jsxs)("button",{onClick:()=>c(!0),className:"btn-primary flex items-center",children:[(0,Gt.jsx)(XO,{className:"h-5 w-5 mr-2"}),"Nouvel Agent"]})]}),o&&(0,Gt.jsxs)("div",{className:"mb-4 flex items-center p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,Gt.jsx)(yr,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-3"}),(0,Gt.jsx)("span",{className:"text-red-700 dark:text-red-300",children:o})]}),(0,Gt.jsxs)("div",{className:"card overflow-hidden",children:[(0,Gt.jsxs)("table",{className:"table",children:[(0,Gt.jsx)("thead",{children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{children:"Nom"}),(0,Gt.jsx)("th",{children:"Email"}),(0,Gt.jsx)("th",{children:"Soci\xe9t\xe9"}),(0,Gt.jsx)("th",{children:"Actions"})]})}),(0,Gt.jsx)("tbody",{children:t.map(t=>(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(sr,{className:"h-5 w-5 text-primary-600 mr-2"}),(0,Gt.jsxs)("span",{className:"font-medium",children:[t.prenom," ",t.nom]})]})}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)(gr,{className:"h-4 w-4 text-gray-400 mr-2"}),t.email]})}),(0,Gt.jsx)("td",{children:t.societe}),(0,Gt.jsx)("td",{children:(0,Gt.jsxs)("div",{className:"flex space-x-2",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{d(e),p({nom:e.nom,prenom:e.prenom,societe:e.societe,email:e.email,password:""}),c(!0)})(t),className:"p-2 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",children:(0,Gt.jsx)(ZO,{className:"h-4 w-4"})}),(0,Gt.jsx)("button",{onClick:()=>(async t=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cet agent ?"))try{await e.delete(`/api/agents/${t}`),h()}catch(o){var r,n;l((null===(r=o.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la suppression")}})(t.id),className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:(0,Gt.jsx)(eE,{className:"h-4 w-4"})})]})})]},t.id))})]}),0===t.length&&(0,Gt.jsx)("div",{className:"p-8 text-center text-gray-500 dark:text-dark-muted",children:"Aucun agent enregistr\xe9"})]}),s&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-md modal-content",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:u?"Modifier l'Agent":"Nouvel Agent"}),(0,Gt.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{u?await e.put(`/api/agents/${u.id}`,f):await e.post("/api/agents",f),h(),m()}catch(o){var r,n;l((null===(r=o.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la sauvegarde")}},className:"space-y-4",children:[(0,Gt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Nom *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:f.nom,onChange:e=>p({...f,nom:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Pr\xe9nom *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:f.prenom,onChange:e=>p({...f,prenom:e.target.value}),className:"input"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Soci\xe9t\xe9 *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:f.societe,onChange:e=>p({...f,societe:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Email *"}),(0,Gt.jsx)("input",{type:"email",required:!0,value:f.email,onChange:e=>p({...f,email:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Mot de passe *"}),(0,Gt.jsx)("input",{type:"password",required:!0,value:f.password,onChange:e=>p({...f,password:e.target.value}),className:"input",placeholder:u?"Nouveau mot de passe":"Mot de passe"})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:m,className:"btn-secondary",children:"Annuler"}),(0,Gt.jsxs)("button",{type:"submit",className:"btn-primary flex items-center",children:[(0,Gt.jsx)(nE,{className:"h-4 w-4 mr-2"}),u?"Modifier":"Cr\xe9er"]})]})]})]})})]})},uE=rr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),dE=rr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),fE=rr("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),pE=rr("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function hE(e){return hE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hE(e)}function mE(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function yE(e){mE(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===hE(e)&&"[object Date]"===t?new Date(e.getTime()):"number"===typeof e||"[object Number]"===t?new Date(e):("string"!==typeof e&&"[object String]"!==t||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function gE(e){if(mE(1,arguments),!function(e){return mE(1,arguments),e instanceof Date||"object"===hE(e)&&"[object Date]"===Object.prototype.toString.call(e)}(e)&&"number"!==typeof e)return!1;var t=yE(e);return!isNaN(Number(t))}function vE(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function bE(e,t){return mE(2,arguments),function(e,t){mE(2,arguments);var r=yE(e).getTime(),n=vE(t);return new Date(r+n)}(e,-vE(t))}function xE(e){mE(1,arguments);var t=yE(e),r=t.getUTCDay(),n=(r<1?7:0)+r-1;return t.setUTCDate(t.getUTCDate()-n),t.setUTCHours(0,0,0,0),t}function wE(e){mE(1,arguments);var t=yE(e),r=t.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(r+1,0,4),n.setUTCHours(0,0,0,0);var a=xE(n),i=new Date(0);i.setUTCFullYear(r,0,4),i.setUTCHours(0,0,0,0);var o=xE(i);return t.getTime()>=a.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}function kE(e){mE(1,arguments);var t=yE(e),r=xE(t).getTime()-function(e){mE(1,arguments);var t=wE(e),r=new Date(0);return r.setUTCFullYear(t,0,4),r.setUTCHours(0,0,0,0),xE(r)}(t).getTime();return Math.round(r/6048e5)+1}var jE={};function SE(){return jE}function NE(e,t){var r,n,a,i,o,l,s,c;mE(1,arguments);var u=SE(),d=vE(null!==(r=null!==(n=null!==(a=null!==(i=null===t||void 0===t?void 0:t.weekStartsOn)&&void 0!==i?i:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(l=o.options)||void 0===l?void 0:l.weekStartsOn)&&void 0!==a?a:u.weekStartsOn)&&void 0!==n?n:null===(s=u.locale)||void 0===s||null===(c=s.options)||void 0===c?void 0:c.weekStartsOn)&&void 0!==r?r:0);if(!(d>=0&&d<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var f=yE(e),p=f.getUTCDay(),h=(p<d?7:0)+p-d;return f.setUTCDate(f.getUTCDate()-h),f.setUTCHours(0,0,0,0),f}function OE(e,t){var r,n,a,i,o,l,s,c;mE(1,arguments);var u=yE(e),d=u.getUTCFullYear(),f=SE(),p=vE(null!==(r=null!==(n=null!==(a=null!==(i=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==i?i:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(l=o.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==a?a:f.firstWeekContainsDate)&&void 0!==n?n:null===(s=f.locale)||void 0===s||null===(c=s.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==r?r:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var h=new Date(0);h.setUTCFullYear(d+1,0,p),h.setUTCHours(0,0,0,0);var m=NE(h,t),y=new Date(0);y.setUTCFullYear(d,0,p),y.setUTCHours(0,0,0,0);var g=NE(y,t);return u.getTime()>=m.getTime()?d+1:u.getTime()>=g.getTime()?d:d-1}function EE(e,t){mE(1,arguments);var r=yE(e),n=NE(r,t).getTime()-function(e,t){var r,n,a,i,o,l,s,c;mE(1,arguments);var u=SE(),d=vE(null!==(r=null!==(n=null!==(a=null!==(i=null===t||void 0===t?void 0:t.firstWeekContainsDate)&&void 0!==i?i:null===t||void 0===t||null===(o=t.locale)||void 0===o||null===(l=o.options)||void 0===l?void 0:l.firstWeekContainsDate)&&void 0!==a?a:u.firstWeekContainsDate)&&void 0!==n?n:null===(s=u.locale)||void 0===s||null===(c=s.options)||void 0===c?void 0:c.firstWeekContainsDate)&&void 0!==r?r:1),f=OE(e,t),p=new Date(0);return p.setUTCFullYear(f,0,d),p.setUTCHours(0,0,0,0),NE(p,t)}(r,t).getTime();return Math.round(n/6048e5)+1}function PE(e,t){for(var r=e<0?"-":"",n=Math.abs(e).toString();n.length<t;)n="0"+n;return r+n}var _E={y:function(e,t){var r=e.getUTCFullYear(),n=r>0?r:1-r;return PE("yy"===t?n%100:n,t.length)},M:function(e,t){var r=e.getUTCMonth();return"M"===t?String(r+1):PE(r+1,2)},d:function(e,t){return PE(e.getUTCDate(),t.length)},a:function(e,t){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:function(e,t){return PE(e.getUTCHours()%12||12,t.length)},H:function(e,t){return PE(e.getUTCHours(),t.length)},m:function(e,t){return PE(e.getUTCMinutes(),t.length)},s:function(e,t){return PE(e.getUTCSeconds(),t.length)},S:function(e,t){var r=t.length,n=e.getUTCMilliseconds();return PE(Math.floor(n*Math.pow(10,r-3)),t.length)}};const CE=_E;var AE="midnight",TE="noon",ME="morning",DE="afternoon",IE="evening",RE="night",LE={G:function(e,t,r){var n=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if("yo"===t){var n=e.getUTCFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return CE.y(e,t)},Y:function(e,t,r,n){var a=OE(e,n),i=a>0?a:1-a;return"YY"===t?PE(i%100,2):"Yo"===t?r.ordinalNumber(i,{unit:"year"}):PE(i,t.length)},R:function(e,t){return PE(wE(e),t.length)},u:function(e,t){return PE(e.getUTCFullYear(),t.length)},Q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return PE(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){var n=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return PE(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){var n=e.getUTCMonth();switch(t){case"M":case"MM":return CE.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){var n=e.getUTCMonth();switch(t){case"L":return String(n+1);case"LL":return PE(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){var a=EE(e,n);return"wo"===t?r.ordinalNumber(a,{unit:"week"}):PE(a,t.length)},I:function(e,t,r){var n=kE(e);return"Io"===t?r.ordinalNumber(n,{unit:"week"}):PE(n,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getUTCDate(),{unit:"date"}):CE.d(e,t)},D:function(e,t,r){var n=function(e){mE(1,arguments);var t=yE(e),r=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var n=r-t.getTime();return Math.floor(n/864e5)+1}(e);return"Do"===t?r.ordinalNumber(n,{unit:"dayOfYear"}):PE(n,t.length)},E:function(e,t,r){var n=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){var a=e.getUTCDay(),i=(a-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return PE(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){var a=e.getUTCDay(),i=(a-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return PE(i,t.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,r){var n=e.getUTCDay(),a=0===n?7:n;switch(t){case"i":return String(a);case"ii":return PE(a,t.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){var n,a=e.getUTCHours();switch(n=12===a?TE:0===a?AE:a/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){var n,a=e.getUTCHours();switch(n=a>=17?IE:a>=12?DE:a>=4?ME:RE,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){var n=e.getUTCHours()%12;return 0===n&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return CE.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getUTCHours(),{unit:"hour"}):CE.H(e,t)},K:function(e,t,r){var n=e.getUTCHours()%12;return"Ko"===t?r.ordinalNumber(n,{unit:"hour"}):PE(n,t.length)},k:function(e,t,r){var n=e.getUTCHours();return 0===n&&(n=24),"ko"===t?r.ordinalNumber(n,{unit:"hour"}):PE(n,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):CE.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):CE.s(e,t)},S:function(e,t){return CE.S(e,t)},X:function(e,t,r,n){var a=(n._originalDate||e).getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return FE(a);case"XXXX":case"XX":return UE(a);default:return UE(a,":")}},x:function(e,t,r,n){var a=(n._originalDate||e).getTimezoneOffset();switch(t){case"x":return FE(a);case"xxxx":case"xx":return UE(a);default:return UE(a,":")}},O:function(e,t,r,n){var a=(n._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+zE(a,":");default:return"GMT"+UE(a,":")}},z:function(e,t,r,n){var a=(n._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+zE(a,":");default:return"GMT"+UE(a,":")}},t:function(e,t,r,n){var a=n._originalDate||e;return PE(Math.floor(a.getTime()/1e3),t.length)},T:function(e,t,r,n){return PE((n._originalDate||e).getTime(),t.length)}};function zE(e,t){var r=e>0?"-":"+",n=Math.abs(e),a=Math.floor(n/60),i=n%60;if(0===i)return r+String(a);var o=t||"";return r+String(a)+o+PE(i,2)}function FE(e,t){return e%60===0?(e>0?"-":"+")+PE(Math.abs(e)/60,2):UE(e,t)}function UE(e,t){var r=t||"",n=e>0?"-":"+",a=Math.abs(e);return n+PE(Math.floor(a/60),2)+r+PE(a%60,2)}const BE=LE;var $E=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},WE=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},qE={p:WE,P:function(e,t){var r,n=e.match(/(P+)(p+)?/)||[],a=n[1],i=n[2];if(!i)return $E(e,t);switch(a){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",$E(a,t)).replace("{{time}}",WE(i,t))}};const KE=qE;var HE=["D","DD"],VE=["YY","YYYY"];function YE(e,t,r){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(r,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var GE={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const XE=function(e,t,r){var n,a=GE[e];return n="string"===typeof a?a:1===t?a.one:a.other.replace("{{count}}",t.toString()),null!==r&&void 0!==r&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function QE(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const JE={date:QE({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:QE({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:QE({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var ZE={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};const eP=function(e,t,r,n){return ZE[e]};function tP(e){return function(t,r){var n;if("formatting"===(null!==r&&void 0!==r&&r.context?String(r.context):"standalone")&&e.formattingValues){var a=e.defaultFormattingWidth||e.defaultWidth,i=null!==r&&void 0!==r&&r.width?String(r.width):a;n=e.formattingValues[i]||e.formattingValues[a]}else{var o=e.defaultWidth,l=null!==r&&void 0!==r&&r.width?String(r.width):e.defaultWidth;n=e.values[l]||e.values[o]}return n[e.argumentCallback?e.argumentCallback(t):t]}}const rP={ordinalNumber:function(e,t){var r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:tP({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:tP({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:tP({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:tP({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:tP({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})};function nP(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.width,a=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],i=t.match(a);if(!i)return null;var o,l=i[0],s=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(s)?function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return r;return}(s,function(e){return e.test(l)}):function(e,t){for(var r in e)if(e.hasOwnProperty(r)&&t(e[r]))return r;return}(s,function(e){return e.test(l)});return o=e.valueCallback?e.valueCallback(c):c,{value:o=r.valueCallback?r.valueCallback(o):o,rest:t.slice(l.length)}}}function aP(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.match(e.matchPattern);if(!n)return null;var a=n[0],i=t.match(e.parsePattern);if(!i)return null;var o=e.valueCallback?e.valueCallback(i[0]):i[0];return{value:o=r.valueCallback?r.valueCallback(o):o,rest:t.slice(a.length)}}}var iP={ordinalNumber:aP({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:nP({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:nP({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:nP({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:nP({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:nP({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})};const oP={code:"en-US",formatDistance:XE,formatLong:JE,formatRelative:eP,localize:rP,match:iP,options:{weekStartsOn:0,firstWeekContainsDate:1}};var lP=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,sP=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,cP=/^'([^]*?)'?$/,uP=/''/g,dP=/[a-zA-Z]/;function fP(e,t,r){var n,a,i,o,l,s,c,u,d,f,p,h,m,y,g,v,b,x;mE(2,arguments);var w=String(t),k=SE(),j=null!==(n=null!==(a=null===r||void 0===r?void 0:r.locale)&&void 0!==a?a:k.locale)&&void 0!==n?n:oP,S=vE(null!==(i=null!==(o=null!==(l=null!==(s=null===r||void 0===r?void 0:r.firstWeekContainsDate)&&void 0!==s?s:null===r||void 0===r||null===(c=r.locale)||void 0===c||null===(u=c.options)||void 0===u?void 0:u.firstWeekContainsDate)&&void 0!==l?l:k.firstWeekContainsDate)&&void 0!==o?o:null===(d=k.locale)||void 0===d||null===(f=d.options)||void 0===f?void 0:f.firstWeekContainsDate)&&void 0!==i?i:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var N=vE(null!==(p=null!==(h=null!==(m=null!==(y=null===r||void 0===r?void 0:r.weekStartsOn)&&void 0!==y?y:null===r||void 0===r||null===(g=r.locale)||void 0===g||null===(v=g.options)||void 0===v?void 0:v.weekStartsOn)&&void 0!==m?m:k.weekStartsOn)&&void 0!==h?h:null===(b=k.locale)||void 0===b||null===(x=b.options)||void 0===x?void 0:x.weekStartsOn)&&void 0!==p?p:0);if(!(N>=0&&N<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!j.localize)throw new RangeError("locale must contain localize property");if(!j.formatLong)throw new RangeError("locale must contain formatLong property");var O=yE(e);if(!gE(O))throw new RangeError("Invalid time value");var E=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}(O),P=bE(O,E),_={firstWeekContainsDate:S,weekStartsOn:N,locale:j,_originalDate:O};return w.match(sP).map(function(e){var t=e[0];return"p"===t||"P"===t?(0,KE[t])(e,j.formatLong):e}).join("").match(lP).map(function(n){if("''"===n)return"'";var a=n[0];if("'"===a)return function(e){var t=e.match(cP);if(!t)return e;return t[1].replace(uP,"'")}(n);var i,o=BE[a];if(o)return null!==r&&void 0!==r&&r.useAdditionalWeekYearTokens||(i=n,-1===VE.indexOf(i))||YE(n,t,String(e)),null!==r&&void 0!==r&&r.useAdditionalDayOfYearTokens||!function(e){return-1!==HE.indexOf(e)}(n)||YE(n,t,String(e)),o(P,n,j.localize,_);if(a.match(dP))throw new RangeError("Format string contains an unescaped latin alphabet character `"+a+"`");return n}).join("")}var pP={lessThanXSeconds:{one:"moins d\u2019une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d\u2019une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d\u2019un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu\u2019un an",other:"presque {{count}} ans"}};const hP=function(e,t,r){var n,a=pP[e];return n="string"===typeof a?a:1===t?a.one:a.other.replace("{{count}}",String(t)),null!==r&&void 0!==r&&r.addSuffix?r.comparison&&r.comparison>0?"dans "+n:"il y a "+n:n};const mP={date:QE({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:QE({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:QE({formats:{full:"{{date}} '\xe0' {{time}}",long:"{{date}} '\xe0' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})};var yP={lastWeek:"eeee 'dernier \xe0' p",yesterday:"'hier \xe0' p",today:"'aujourd\u2019hui \xe0' p",tomorrow:"'demain \xe0' p'",nextWeek:"eeee 'prochain \xe0' p",other:"P"};const gP=function(e,t,r,n){return yP[e]};var vP={ordinalNumber:function(e,t){var r=Number(e),n=null===t||void 0===t?void 0:t.unit;if(0===r)return"0";return r+(1===r?n&&["year","week","hour","minute","second"].includes(n)?"\xe8re":"er":"\xe8me")},era:tP({values:{narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant J\xe9sus-Christ","apr\xe8s J\xe9sus-Christ"]},defaultWidth:"wide"}),quarter:tP({values:{narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2\xe8me trim.","3\xe8me trim.","4\xe8me trim."],wide:["1er trimestre","2\xe8me trimestre","3\xe8me trimestre","4\xe8me trimestre"]},defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:tP({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","f\xe9vr.","mars","avr.","mai","juin","juil.","ao\xfbt","sept.","oct.","nov.","d\xe9c."],wide:["janvier","f\xe9vrier","mars","avril","mai","juin","juillet","ao\xfbt","septembre","octobre","novembre","d\xe9cembre"]},defaultWidth:"wide"}),day:tP({values:{narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},defaultWidth:"wide"}),dayPeriod:tP({values:{narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"apr\xe8s-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l\u2019apr\xe8s-midi",evening:"du soir",night:"du matin"}},defaultWidth:"wide"})};const bP=vP;var xP={ordinalNumber:aP({matchPattern:/^(\d+)(i\xe8me|\xe8re|\xe8me|er|e)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e)}}),era:nP({matchPatterns:{narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant J\xe9sus-Christ|apr\xe8s J\xe9sus-Christ)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^av/i,/^ap/i]},defaultParseWidth:"any"}),quarter:nP({matchPatterns:{narrow:/^T?[1234]/i,abbreviated:/^[1234](er|\xe8me|e)? trim\.?/i,wide:/^[1234](er|\xe8me|e)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:nP({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(janv|f\xe9vr|mars|avr|mai|juin|juill|juil|ao\xfbt|sept|oct|nov|d\xe9c)\.?/i,wide:/^(janvier|f\xe9vrier|mars|avril|mai|juin|juillet|ao\xfbt|septembre|octobre|novembre|d\xe9cembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:nP({matchPatterns:{narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:nP({matchPatterns:{narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'apr\xe8s[-\s]midi|du soir|de la nuit)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},defaultParseWidth:"any"})};const wP={code:"fr",formatDistance:hP,formatLong:mP,formatRelative:gP,localize:bP,match:xP,options:{weekStartsOn:1,firstWeekContainsDate:4}},kP=()=>{const{isAgent:e,api:t,user:r}=Qt(),[n,i]=(0,a.useState)([]),[o,l]=(0,a.useState)([]),[s,c]=(0,a.useState)([]),[u,d]=(0,a.useState)(!0),[f,p]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[y,g]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),[x,w]=(0,a.useState)(null),[k,j]=(0,a.useState)([]),[S,N]=(0,a.useState)(""),[O,E]=(0,a.useState)(!1),[P,_]=(0,a.useState)(!1),[C,A]=(0,a.useState)([]),[T,M]=(0,a.useState)(!1),[D,I]=(0,a.useState)(!1),[R,L]=(0,a.useState)(!1),[z,F]=(0,a.useState)(!1),[U,B]=(0,a.useState)("active"),[$,W]=(0,a.useState)(""),[q,K]=(0,a.useState)(""),[H,V]=(0,a.useState)({titre:"",client_id:"",demandeur_id:"",status:"nouveau",date_fin_prevue:"",requete_initiale:""}),Y=e=>{const t=e.prenom||e.nom?`${e.prenom||""} ${e.nom||""}`.trim():"";return t?`${e.nom_societe} - ${t}`:e.nom_societe},G=[{value:"",label:"Tous les clients",subtitle:""},...Array.isArray(o)?o.map(e=>({value:e.id,label:e.nom_societe,subtitle:e.prenom||e.nom?`${e.prenom||""} ${e.nom||""}`.trim():"",searchText:`${e.nom_societe} ${e.prenom||""} ${e.nom||""}`.toLowerCase()})):[]];(0,a.useEffect)(()=>{X(),Q(),e&&J()},[e,U,$,q]);const X=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&F(!0);try{let e={};"active"===U&&(e.status_filter="nouveau,en_cours,en_attente,repondu"),$&&(e.client_id=$),q&&(e.search=q);const r=Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():"",n=await t.get(`/api/tickets${r}`);i(n.data)}catch(f){p("Erreur lors du chargement des tickets")}finally{d(!1),e&&F(!1)}},Q=async()=>{try{const e=await t.get("/api/clients");e.data.data&&e.data.pagination?l(e.data.data):l(e.data)}catch(f){console.error("Erreur lors du chargement des clients:",f)}},J=async()=>{try{const e=await t.get("/api/demandeurs");c(e.data)}catch(f){console.error("Erreur lors du chargement des demandeurs:",f)}},Z=async e=>{M(!0);try{const r=await t.get(`/api/ticket-fichiers?ticketId=${e}`);A(r.data)}catch(f){console.error("Erreur lors du chargement des fichiers:",f)}finally{M(!1)}},ee=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},te=async e=>{E(!0);try{const r=await t.get(`/api/ticket-echanges?ticketId=${e}`);j(r.data),setTimeout(()=>{const e=document.querySelector(".comments-scroll-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)}catch(f){console.error("Erreur lors du chargement des \xe9changes:",f)}finally{E(!1)}},re=async r=>{if(r.preventDefault(),S.trim()&&!R){L(!0);try{const r=await t.post(`/api/ticket-echanges?ticketId=${x.id}`,{message:S}),n=[...k,r.data];j(n),N(""),e&&"repondu"!==x.status&&await ne(x.id,"repondu"),setTimeout(()=>{const e=document.querySelector(".comments-scroll-container");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},100)}catch(f){var n,a;p((null===(n=f.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.detail)||"Erreur lors de l'ajout du commentaire")}finally{L(!1)}}},ne=async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const a=n||x;await t.put(`/api/tickets/${e}`,{...a,status:r});const i={...n||x,status:r};w(i),X()}catch(f){var a,i;p((null===(a=f.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.detail)||"Erreur lors de la mise \xe0 jour du statut")}},ae=()=>{m(!1),b(null),V({titre:"",client_id:"",demandeur_id:"",status:"nouveau",date_fin_prevue:"",requete_initiale:""}),p("")},ie=e=>(0,Gt.jsx)("span",{className:`status-badge ${{nouveau:"status-nouveau",en_cours:"status-en-cours",en_attente:"status-en-attente",repondu:"status-repondu",resolu:"status-resolu",ferme:"status-ferme"}[e]}`,children:{nouveau:"Nouveau",en_cours:"En cours",en_attente:"En attente",repondu:"R\xe9pondu",resolu:"R\xe9solu",ferme:"Ferm\xe9"}[e]||e});return u?(0,Gt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):(0,Gt.jsxs)("div",{className:"fade-in",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,Gt.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:e?"Supervision des Tickets":"Mes Tickets"}),(0,Gt.jsxs)("div",{className:"flex space-x-3",children:[(0,Gt.jsxs)("button",{onClick:()=>X(!0),className:"btn-secondary flex items-center",title:"Actualiser la liste",disabled:z,children:[(0,Gt.jsx)(uE,{className:"h-5 w-5 mr-2 "+(z?"animate-spin":"")}),z?"Actualisation...":"Actualiser"]}),(0,Gt.jsxs)("button",{onClick:()=>m(!0),className:"btn-primary flex items-center",children:[(0,Gt.jsx)(XO,{className:"h-5 w-5 mr-2"}),"Nouveau Ticket"]})]})]}),(0,Gt.jsxs)("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Statut des tickets"}),(0,Gt.jsxs)("select",{value:U,onChange:e=>B(e.target.value),className:"input w-full",children:[(0,Gt.jsx)("option",{value:"active",children:"Actifs (Nouveau, En cours, En attente, R\xe9pondu)"}),(0,Gt.jsx)("option",{value:"all",children:"Tous les tickets"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Filtrer par client"}),(0,Gt.jsx)(lE,{options:G,value:$,onChange:W,placeholder:"Tous les clients",className:"w-full",displayKey:"label",valueKey:"value",searchKeys:["label","subtitle","searchText"],emptyMessage:"Aucun client trouv\xe9"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Rechercher par num\xe9ro"}),(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("input",{type:"text",placeholder:"Ex: 123456",value:q,onChange:e=>K(e.target.value),className:"input w-full pr-10",maxLength:6}),(0,Gt.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,Gt.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),q&&(0,Gt.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Recherche par num\xe9ro de ticket"})]})]}),f&&(0,Gt.jsxs)("div",{className:"mb-4 flex items-center p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,Gt.jsx)(yr,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-3"}),(0,Gt.jsx)("span",{className:"text-red-700 dark:text-red-300",children:f})]}),(0,Gt.jsxs)("div",{className:"grid gap-4",children:[n.map(r=>(0,Gt.jsx)("div",{className:"card p-6",children:(0,Gt.jsxs)("div",{className:"flex items-start justify-between",children:[(0,Gt.jsxs)("div",{className:"flex-1",children:[(0,Gt.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,Gt.jsx)(ar,{className:"h-5 w-5 text-primary-600"}),(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-dark-text",children:r.titre}),(0,Gt.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:["#",r.numero_ticket]}),ie(r.status)]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[(0,Gt.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-dark-muted",children:[(0,Gt.jsx)(JO,{className:"h-4 w-4 mr-2"}),(0,Gt.jsxs)("span",{children:["Client: ",Y({nom_societe:r.client_nom,prenom:r.client_prenom,nom:r.client_nom_personne})]})]}),(0,Gt.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-dark-muted",children:[(0,Gt.jsx)(dE,{className:"h-4 w-4 mr-2"}),(0,Gt.jsxs)("span",{children:["Demandeur: ",r.demandeur_prenom," ",r.demandeur_nom]})]}),(0,Gt.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-dark-muted",children:[(0,Gt.jsx)(fE,{className:"h-4 w-4 mr-2"}),(0,Gt.jsxs)("span",{children:["Cr\xe9\xe9 le: ",fP(new Date(r.date_creation),"dd MMM yyyy",{locale:wP})]})]})]}),r.date_fin_prevue&&(0,Gt.jsxs)("div",{className:"flex items-center text-sm text-orange-600 dark:text-orange-400 mt-2",children:[(0,Gt.jsx)(VO,{className:"h-4 w-4 mr-2"}),(0,Gt.jsxs)("span",{children:["\xc9ch\xe9ance: ",fP(new Date(r.date_fin_prevue),"dd MMM yyyy",{locale:wP})]})]}),(0,Gt.jsx)("p",{className:"text-gray-700 dark:text-dark-text mt-3 line-clamp-2",children:r.requete_initiale})]}),(0,Gt.jsxs)("div",{className:"flex space-x-2 ml-4",children:[(0,Gt.jsx)("button",{onClick:()=>(t=>{w(t),g(!0),te(t.id),Z(t.id),e&&"nouveau"===t.status&&ne(t.id,"en_cours",t)})(r),className:"p-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",title:"Voir le d\xe9tail",children:(0,Gt.jsx)(pE,{className:"h-4 w-4"})}),e&&(0,Gt.jsx)("button",{onClick:()=>(e=>{b(e),V({titre:e.titre,client_id:e.client_id,demandeur_id:e.demandeur_id||"",status:e.status,date_fin_prevue:e.date_fin_prevue?e.date_fin_prevue.split("T")[0]:"",requete_initiale:e.requete_initiale}),m(!0)})(r),className:"p-2 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",title:"Modifier",children:(0,Gt.jsx)(ZO,{className:"h-4 w-4"})}),e&&(0,Gt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce ticket ?"))try{await t.delete(`/api/tickets/${e}`),X()}catch(f){var r,n;p((null===(r=f.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la suppression")}})(r.id),className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Supprimer",children:(0,Gt.jsx)(eE,{className:"h-4 w-4"})})]})]})},r.id)),0===n.length&&(0,Gt.jsxs)("div",{className:"card p-12 text-center",children:[(0,Gt.jsx)(ar,{className:"h-16 w-16 text-gray-300 dark:text-dark-muted mx-auto mb-4"}),(0,Gt.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-2",children:"Aucun ticket"}),(0,Gt.jsx)("p",{className:"text-gray-500 dark:text-dark-muted",children:e?"Aucun ticket n'a \xe9t\xe9 cr\xe9\xe9 pour le moment.":"Vous n'avez aucun ticket. Cr\xe9ez-en un nouveau !"})]})]}),h&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-2xl modal-content max-h-90vh overflow-y-auto",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-dark-text",children:v?"Modifier le Ticket":"Nouveau Ticket"}),(0,Gt.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{v?await t.put(`/api/tickets/${v.id}`,H):await t.post("/api/tickets",H),X(),ae()}catch(f){var r,n;p((null===(r=f.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la sauvegarde")}},className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Titre *"}),(0,Gt.jsx)("input",{type:"text",required:!0,value:H.titre,onChange:e=>V({...H,titre:e.target.value}),className:"input"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Client *"}),(0,Gt.jsx)(lE,{options:Array.isArray(o)?o.map(e=>({value:e.id,label:e.nom_societe,subtitle:e.prenom||e.nom?`${e.prenom||""} ${e.nom||""}`.trim():""})):[],value:H.client_id,onChange:e=>V({...H,client_id:e}),placeholder:"S\xe9lectionner un client",displayKey:"label",valueKey:"value",searchKeys:["label","subtitle"],emptyMessage:"Aucun client trouv\xe9"})]}),e&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Demandeur *"}),(0,Gt.jsxs)("select",{required:!0,value:H.demandeur_id,onChange:e=>V({...H,demandeur_id:e.target.value}),className:"input",children:[(0,Gt.jsx)("option",{value:"",children:"S\xe9lectionner un demandeur"}),s.map(e=>(0,Gt.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom," - ",e.societe]},e.id))]})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Statut"}),(0,Gt.jsxs)("select",{value:H.status,onChange:e=>V({...H,status:e.target.value}),className:"input",children:[(0,Gt.jsx)("option",{value:"nouveau",children:"Nouveau"}),(0,Gt.jsx)("option",{value:"en_cours",children:"En cours"}),(0,Gt.jsx)("option",{value:"en_attente",children:"En attente"}),(0,Gt.jsx)("option",{value:"repondu",children:"R\xe9pondu"}),(0,Gt.jsx)("option",{value:"resolu",children:"R\xe9solu"}),(0,Gt.jsx)("option",{value:"ferme",children:"Ferm\xe9"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Date de fin pr\xe9vue"}),(0,Gt.jsx)("input",{type:"date",value:H.date_fin_prevue,onChange:e=>V({...H,date_fin_prevue:e.target.value}),className:"input"})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Requ\xeate initiale *"}),(0,Gt.jsx)("textarea",{required:!0,value:H.requete_initiale,onChange:e=>V({...H,requete_initiale:e.target.value}),className:"input h-32 resize-none",placeholder:"D\xe9crivez la demande ou le probl\xe8me..."})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:ae,className:"btn-secondary",children:"Annuler"}),(0,Gt.jsx)("button",{type:"submit",className:"btn-primary",children:v?"Modifier":"Cr\xe9er"})]})]})]})}),y&&x&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 modal-overlay",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 w-full max-w-4xl modal-content max-h-90vh overflow-y-auto",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,Gt.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-dark-text",children:"D\xe9tail du Ticket"}),(0,Gt.jsx)("button",{onClick:()=>{g(!1),w(null),j([]),N(""),_(!1)},className:"text-gray-500 hover:text-gray-700 dark:text-dark-muted dark:hover:text-dark-text",children:"\u2715"})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{className:"space-y-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-dark-text mb-2",children:x.titre}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,Gt.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full",children:["Ticket #",x.numero_ticket]}),ie(x.status),e&&(0,Gt.jsxs)("select",{value:x.status,onChange:e=>ne(x.id,e.target.value),className:"text-xs px-2 py-1 rounded border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-surface text-gray-700 dark:text-dark-text focus:ring-2 focus:ring-primary-500",children:[(0,Gt.jsx)("option",{value:"nouveau",children:"Nouveau"}),(0,Gt.jsx)("option",{value:"en_cours",children:"En cours"}),(0,Gt.jsx)("option",{value:"en_attente",children:"En attente"}),(0,Gt.jsx)("option",{value:"repondu",children:"R\xe9pondu"}),(0,Gt.jsx)("option",{value:"resolu",children:"R\xe9solu"}),(0,Gt.jsx)("option",{value:"ferme",children:"Ferm\xe9"})]})]})]}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Client"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-dark-text",children:Y({nom_societe:x.client_nom,prenom:x.client_prenom,nom:x.client_nom_personne})})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Demandeur"}),(0,Gt.jsxs)("p",{className:"text-gray-900 dark:text-dark-text",children:[x.demandeur_prenom," ",x.demandeur_nom]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Date de cr\xe9ation"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-dark-text",children:fP(new Date(x.date_creation),"dd MMMM yyyy \xe0 HH:mm",{locale:wP})})]}),x.date_fin_prevue&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-1",children:"Date de fin pr\xe9vue"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-dark-text",children:fP(new Date(x.date_fin_prevue),"dd MMMM yyyy",{locale:wP})})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text mb-2",children:"Requ\xeate initiale"}),(0,Gt.jsx)("div",{className:"bg-gray-50 dark:bg-dark-card p-4 rounded-lg",children:(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-dark-text whitespace-pre-wrap",children:x.requete_initiale})})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text",children:"Fichiers joints"}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsx)("input",{type:"file",id:"fileUpload",className:"hidden",accept:".jpg,.jpeg,.png,.gif,.pdf,.wav,.txt,.doc,.docx",onChange:async r=>{const n=r.target.files[0];if(!n)return;if(n.size>10485760)return void p("Fichier trop volumineux (limite: 10MB)");if(["image/jpeg","image/png","image/gif","image/webp","application/pdf","audio/wav","audio/wave","audio/x-wav","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(n.type)){I(!0);try{const a=await new Promise((e,t)=>{const r=new FileReader;r.onload=()=>e(r.result.split(",")[1]),r.onerror=t,r.readAsDataURL(n)}),i={nom_fichier:n.name,type_fichier:n.type,taille_fichier:n.size,contenu_base64:a};await t.post(`/api/ticket-fichiers?ticketId=${x.id}`,i);try{const r=await t.post(`/api/ticket-echanges?ticketId=${x.id}`,{message:`A ajout\xe9 une pi\xe8ce jointe ${n.name}`});j([...k,r.data]),e&&"repondu"!==x.status&&await ne(x.id,"repondu")}catch(o){console.error("Erreur lors de l'ajout du commentaire automatique:",o)}Z(x.id),r.target.value=""}catch(f){var a,i;p((null===(a=f.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.detail)||"Erreur lors de l'upload du fichier")}finally{I(!1)}}else p("Type de fichier non autoris\xe9. Formats accept\xe9s: Images, PDF, WAV, TXT, DOC")},disabled:D}),(0,Gt.jsx)("label",{htmlFor:"fileUpload",className:"text-sm px-3 py-1 rounded border transition-colors cursor-pointer "+(D?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-500 text-white hover:bg-primary-600 border-primary-500"),children:D?"Upload...":"+ Ajouter un fichier"})]})]}),T?(0,Gt.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):C.length>0?(0,Gt.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:C.map(r=>{return(0,Gt.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-dark-card rounded border",children:[(0,Gt.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,Gt.jsx)("span",{className:"text-lg",children:(n=r.type_fichier,null!==n&&void 0!==n&&n.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===n?"\ud83d\udcc4":null!==n&&void 0!==n&&n.startsWith("audio/")?"\ud83c\udfb5":null!==n&&void 0!==n&&n.includes("word")?"\ud83d\udcdd":"\ud83d\udcce")}),(0,Gt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-dark-text truncate",children:r.nom_fichier}),(0,Gt.jsxs)("p",{className:"text-xs text-gray-500 dark:text-dark-muted",children:[ee(r.taille_fichier)," \u2022 ",r.uploaded_by_name," \u2022 ",fP(new Date(r.uploaded_at),"dd/MM/yyyy HH:mm",{locale:wP})]})]})]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{try{const t=atob(e.contenu_base64),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);const n=new Uint8Array(r),a=new Blob([n],{type:e.type_fichier}),i=window.URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e.nom_fichier,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i)}catch(f){p("Erreur lors du t\xe9l\xe9chargement du fichier")}})(r),className:"p-1 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",title:"T\xe9l\xe9charger",children:(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(e||"demandeur"===r.uploaded_by_type)&&(0,Gt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce fichier ?"))try{await t.delete(`/api/ticket-fichiers?ticketId=${x.id}&fileId=${e}`),Z(x.id)}catch(f){var r,n;p((null===(r=f.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.detail)||"Erreur lors de la suppression du fichier")}})(r.id),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Supprimer",children:(0,Gt.jsx)(eE,{className:"w-4 h-4"})})]})]},r.id);var n})}):(0,Gt.jsx)("p",{className:"text-sm text-gray-500 dark:text-dark-muted italic py-2",children:"Aucun fichier joint pour le moment"}),(0,Gt.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2",children:"Formats accept\xe9s: Images (JPG, PNG, GIF), PDF, Audio (WAV), Documents (TXT, DOC) \u2022 Taille max: 10MB"})]})]}),(0,Gt.jsxs)("div",{className:"flex flex-col h-full min-h-[500px]",children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-dark-text",children:"\xc9changes et commentaires"}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-3",children:[k.length>0&&(0,Gt.jsxs)("span",{className:"text-sm text-gray-500 dark:text-dark-muted",children:[k.length," commentaire",k.length>1?"s":""]}),(0,Gt.jsxs)("button",{onClick:()=>te(x.id),className:"flex items-center space-x-1 text-sm text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300 transition-colors",title:"Actualiser les commentaires",disabled:O,children:[(0,Gt.jsx)(uE,{className:"h-4 w-4 "+(O?"animate-spin":"")}),(0,Gt.jsx)("span",{children:"Actualiser"})]})]})]}),(0,Gt.jsxs)("div",{className:"flex-1 border border-gray-200 dark:border-dark-border rounded-lg mb-4 bg-gray-50 dark:bg-dark-card relative",children:[(0,Gt.jsx)("div",{className:"h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent p-4 pb-8 comments-scroll-container bg-gradient-to-b from-gray-50 to-gray-100 dark:from-dark-card dark:to-dark-surface",children:O?(0,Gt.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):k.length>0?(0,Gt.jsx)("div",{className:"space-y-3",children:k.map((t,n)=>{const a=r&&(e&&"agent"===t.auteur_type||!e&&"demandeur"===t.auteur_type),i="agent"===t.auteur_type;return(0,Gt.jsx)("div",{className:`flex ${a?"justify-end":"justify-start"} ${n===k.length-1?"animate-fade-in":""}`,children:(0,Gt.jsxs)("div",{className:"max-w-xs lg:max-w-md "+(a?"order-2":"order-1"),children:[(0,Gt.jsx)("div",{className:"rounded-2xl px-4 py-3 shadow-sm "+(a?"bg-primary-500 text-white rounded-br-md":"bg-white dark:bg-dark-surface text-gray-900 dark:text-dark-text rounded-bl-md border border-gray-200 dark:border-dark-border"),children:(0,Gt.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:t.message})}),(0,Gt.jsx)("div",{className:"flex items-center mt-1 text-xs text-gray-500 dark:text-dark-muted "+(a?"justify-end":"justify-start"),children:(0,Gt.jsxs)("div",{className:"flex items-center space-x-2 "+(a?"flex-row-reverse space-x-reverse":""),children:[(0,Gt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium text-white comment-avatar "+(i?"bg-primary-600":"bg-green-500"),children:t.auteur_nom.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase()}),(0,Gt.jsx)("span",{className:"font-medium",children:a?"Moi":t.auteur_nom}),(0,Gt.jsx)("span",{children:"\u2022"}),(0,Gt.jsx)("span",{children:fP(new Date(t.created_at),"dd/MM/yyyy HH:mm",{locale:wP})})]})})]})},t.id)})}):(0,Gt.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,Gt.jsx)("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4",children:(0,Gt.jsx)("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Gt.jsx)("p",{className:"text-gray-500 dark:text-dark-muted",children:"Aucune conversation pour ce ticket"}),(0,Gt.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-600 mt-1",children:"Commencez la discussion en envoyant le premier message"})]})}),k.length>3&&(0,Gt.jsx)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400 dark:text-gray-500 bg-white dark:bg-dark-surface px-2 py-1 rounded shadow",children:"Faire d\xe9filer pour voir plus"})]}),(0,Gt.jsx)("div",{className:"border-t border-gray-200 dark:border-dark-border pt-4",children:(0,Gt.jsxs)("form",{onSubmit:re,className:"space-y-3",children:[(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,Gt.jsxs)("button",{type:"button",onClick:()=>_(!P),className:"text-sm text-gray-500 hover:text-gray-700 dark:text-dark-muted dark:hover:text-dark-text flex items-center space-x-1 disabled:opacity-50",disabled:R,children:[(0,Gt.jsx)("span",{className:"text-lg",children:"\ud83d\ude0a"}),(0,Gt.jsx)("span",{children:"\xc9mojis"})]})}),P&&(0,Gt.jsxs)("div",{className:"absolute bottom-full left-0 mb-2 emoji-picker border border-gray-200 dark:border-dark-border rounded-lg p-3 shadow-xl z-10 w-full max-w-xs",children:[(0,Gt.jsx)("div",{className:"grid grid-cols-8 gap-1",children:["\ud83d\ude0a","\ud83d\udc4d","\ud83d\udc4e","\u2764\ufe0f","\ud83d\ude22","\ud83d\ude02","\ud83d\udd25","\ud83d\udca1","\u2705","\u274c","\u26a0\ufe0f","\ud83e\udd14","\ud83d\udc4c","\ud83d\ude4f","\ud83d\udcaa","\ud83c\udf89"].map((e,t)=>(0,Gt.jsx)("button",{type:"button",onClick:()=>(e=>{N(S+e),_(!1)})(e),className:"w-8 h-8 flex items-center justify-center hover:bg-gray-100 dark:hover:bg-dark-card rounded text-lg emoji-button",title:`Ajouter ${e}`,children:e},t))}),(0,Gt.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-dark-border",children:(0,Gt.jsx)("button",{type:"button",onClick:()=>_(!1),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-dark-muted dark:hover:text-dark-text w-full text-center py-1",children:"Fermer"})})]})]}),(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("textarea",{value:S,onChange:e=>N(e.target.value),placeholder:"Tapez votre message...",className:"input h-20 resize-none pr-12 focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,maxLength:1e3,disabled:R,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||R||(e.preventDefault(),re(e))}}),(0,Gt.jsxs)("div",{className:`absolute bottom-2 right-2 text-xs ${S.length>900?"text-red-500":S.length>800?"text-yellow-500":"text-gray-400 dark:text-gray-500"} character-counter ${S.length>900?"danger":S.length>800?"warning":""}`,children:[S.length,"/1000"]})]}),(0,Gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Gt.jsx)("span",{className:"text-xs text-gray-500 dark:text-dark-muted",children:"\ud83d\udca1 Appuyez sur Entr\xe9e pour envoyer \u2022 Shift+Entr\xe9e pour saut de ligne"}),(0,Gt.jsxs)("div",{className:"flex space-x-2",children:[P&&(0,Gt.jsx)("button",{type:"button",onClick:()=>_(!1),className:"text-xs text-gray-500 hover:text-gray-700 dark:text-dark-muted dark:hover:text-dark-text px-2 py-1",children:"Fermer"}),(0,Gt.jsx)("button",{type:"submit",className:"btn-primary flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!S.trim()||R,children:R?(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,Gt.jsx)("span",{children:"Envoi..."})]}):(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,Gt.jsx)("span",{children:"Envoyer"})]})})]})]})]})})]})]})]})})]})},jP=e=>{let{portabiliteId:t,onClose:r,onEdit:n}=e;const{user:i,api:o}=(0,a.useContext)(Xt),[l,s]=(0,a.useState)(null),[c,u]=(0,a.useState)([]),[d,f]=(0,a.useState)([]),[p,h]=(0,a.useState)(!0),[m,y]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),[b,x]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[j,S]=(0,a.useState)(""),[N,O]=(0,a.useState)(!1),[E,P]=(0,a.useState)(""),[_,C]=(0,a.useState)(!1),A=(0,a.useRef)(null),T={nouveau:"Nouveau",bloque:"Bloqu\xe9",rejete:"Rejet\xe9",en_cours:"En cours",demande:"Demand\xe9",valide:"Valid\xe9",termine:"Termin\xe9"},M=async()=>{try{const e=await o.get(`/api/portabilites/${t}`);console.log("Portabilit\xe9 data received:",e.data);const r=Array.isArray(e.data)?e.data[0]:e.data;console.log("Portabilit\xe9 object:",r),s(r)}catch(e){k("Erreur lors du chargement de la portabilit\xe9"),console.error("Erreur:",e)}},D=async()=>{y(!0);try{const e=await o.get(`/api/portabilite-fichiers?portabiliteId=${t}`);f(e.data)}catch(e){console.error("Erreur lors du chargement des fichiers:",e)}finally{y(!1)}},I=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},R=async()=>{try{const e=await o.get(`/api/portabilite-echanges?portabiliteId=${t}`);u(e.data)}catch(e){console.error("Erreur lors du chargement des commentaires:",e)}},L=async e=>{if(e.preventDefault(),j.trim()){v(!0);try{const e=await o.post("/api/portabilite-echanges",{portabiliteId:t,message:j.trim()});u([...c,e.data]),S(""),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100)}catch(r){k("Erreur lors de l'envoi du commentaire"),console.error("Erreur:",r)}finally{v(!1)}}};return(0,a.useEffect)(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[c]),(0,a.useEffect)(()=>{(async()=>{h(!0),await Promise.all([M(),R(),D()]),h(!1)})()},[t]),p?(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500 mx-auto"})})}):l?(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[(0,Gt.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700 p-6",children:(0,Gt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:["Portabilit\xe9 #",l.numero_portabilite]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Gt.jsx)("span",{className:`px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full ${{nouveau:"bg-blue-100 text-blue-800",bloque:"bg-red-100 text-red-800",rejete:"bg-red-100 text-red-800",en_cours:"bg-yellow-100 text-yellow-800",demande:"bg-orange-100 text-orange-800",valide:"bg-green-100 text-green-800",termine:"bg-gray-100 text-gray-800"}[l.status]||"bg-gray-100 text-gray-800"}`,children:T[l.status]||l.status}),(e=>{if(!e)return!1;const t=new Date;return new Date(e).toDateString()===t.toDateString()})(l.date_portabilite_effective)&&(0,Gt.jsx)("span",{className:"text-red-500 font-semibold",children:"\ud83d\udea8 Portabilit\xe9 effective aujourd'hui"})]})]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:["agent"===i.type_utilisateur&&(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("button",{onClick:()=>{r(),n(t)},className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Modifier"}),(0,Gt.jsx)("button",{onClick:()=>{P(l.status),O(!0)},className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Changer statut"}),(0,Gt.jsx)("button",{onClick:async()=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette portabilit\xe9 ?"))try{await o.delete(`/api/portabilites/${t}`),r(),window.refreshPortabilites&&window.refreshPortabilites()}catch(e){k("Erreur lors de la suppression"),console.error("Erreur:",e)}},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Supprimer"})]}),"demandeur"===i.type_utilisateur&&(0,Gt.jsx)("button",{onClick:async()=>{if(window.confirm("\xcates-vous s\xfbr de vouloir demander l'annulation de cette portabilit\xe9 ?")){v(!0);try{const e=await o.post("/api/portabilite-echanges",{portabiliteId:t,message:"Demande d'annulation sans r\xe9serves"});u([...c,e.data]),setTimeout(()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100)}catch(e){k("Erreur lors de l'envoi de la demande d'annulation"),console.error("Erreur:",e)}finally{v(!1)}}},disabled:g,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:g?(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),(0,Gt.jsx)("span",{children:"Envoi..."})]}):(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("span",{children:"Annulation"}),(0,Gt.jsx)("span",{children:"\u26a0\ufe0f"})]})}),(0,Gt.jsx)("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-4"}),(0,Gt.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-1",children:(0,Gt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),(0,Gt.jsx)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)]",children:(0,Gt.jsxs)("div",{className:"space-y-6",children:[(0,Gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[(0,Gt.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Informations g\xe9n\xe9rales"}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Client"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:l.client_display||l.nom_societe})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Demandeur"}),(0,Gt.jsxs)("p",{className:"text-gray-900 dark:text-white",children:[l.demandeur_prenom," ",l.demandeur_nom]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date de cr\xe9ation"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:(z=l.date_creation,z?new Date(z).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-")})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date souhait\xe9e"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:l.date_portabilite_demandee?new Date(l.date_portabilite_demandee).toLocaleDateString("fr-FR"):"-"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date effective"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:l.date_portabilite_effective?new Date(l.date_portabilite_effective).toLocaleDateString("fr-FR"):"-"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Num\xe9ros \xe0 porter"}),(0,Gt.jsx)("div",{className:"bg-white dark:bg-gray-700 p-3 rounded-md",children:(0,Gt.jsx)("pre",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:l.numeros_portes})})]}),l.adresse&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Adresse"}),(0,Gt.jsxs)("p",{className:"text-gray-900 dark:text-white",children:[l.adresse,l.code_postal&&`, ${l.code_postal}`,l.ville&&` ${l.ville}`]})]}),(0,Gt.jsxs)("div",{className:"flex space-x-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Fiabilisation"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:l.fiabilisation_demandee?"\u2705 Oui":"\u274c Non"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Demande sign\xe9e"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:l.demande_signee?"\u2705 Oui":"\u274c Non"})]})]})]})]}),(0,Gt.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"\xc9changes et commentaires"}),(0,Gt.jsx)("div",{className:"flex items-center space-x-3",children:c.length>0&&(0,Gt.jsxs)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[c.length," commentaire",c.length>1?"s":""]})})]}),(0,Gt.jsxs)("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg mb-4 bg-gray-50 dark:bg-gray-700 relative",children:[(0,Gt.jsxs)("div",{className:"h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-gray-600 scrollbar-track-transparent p-4 pb-8 bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800",children:[c.length>0?(0,Gt.jsx)("div",{className:"space-y-3",children:c.map((e,t)=>{const r=i&&("agent"===i.type_utilisateur&&"agent"===e.auteur_type||"demandeur"===i.type_utilisateur&&"demandeur"===e.auteur_type),n="agent"===e.auteur_type;return(0,Gt.jsx)("div",{className:`flex ${r?"justify-end":"justify-start"} ${t===c.length-1?"animate-fade-in":""}`,children:(0,Gt.jsxs)("div",{className:"max-w-xs lg:max-w-md "+(r?"order-2":"order-1"),children:[(0,Gt.jsx)("div",{className:"rounded-2xl px-4 py-3 shadow-sm "+(r?"bg-purple-500 text-white rounded-br-md":"bg-white dark:bg-gray-600 text-gray-900 dark:text-white rounded-bl-md border border-gray-200 dark:border-gray-500"),children:(0,Gt.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap break-words",children:e.message})}),(0,Gt.jsx)("div",{className:"flex items-center mt-1 text-xs text-gray-500 dark:text-gray-400 "+(r?"justify-end":"justify-start"),children:(0,Gt.jsxs)("div",{className:"flex items-center space-x-2 "+(r?"flex-row-reverse space-x-reverse":""),children:[(0,Gt.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium text-white "+(n?"bg-purple-600":"bg-green-500"),children:e.auteur_nom?e.auteur_nom.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase():"A"}),(0,Gt.jsx)("span",{className:"font-medium",children:r?"Moi":e.auteur_nom||"Utilisateur"}),(0,Gt.jsx)("span",{children:"\u2022"}),(0,Gt.jsx)("span",{children:fP(new Date(e.created_at),"dd/MM/yyyy HH:mm",{locale:wP})})]})})]})},e.id)})}):(0,Gt.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,Gt.jsx)("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center mb-4",children:(0,Gt.jsx)("svg",{className:"w-8 h-8 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,Gt.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune conversation pour cette portabilit\xe9"}),(0,Gt.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"Commencez la discussion en envoyant le premier message"})]}),(0,Gt.jsx)("div",{ref:A})]}),c.length>3&&(0,Gt.jsx)("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400 dark:text-gray-500 bg-white dark:bg-gray-600 px-2 py-1 rounded shadow",children:"Faire d\xe9filer pour voir plus"})]}),(0,Gt.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-600 pt-4",children:(0,Gt.jsxs)("form",{onSubmit:L,className:"space-y-3",children:[(0,Gt.jsxs)("div",{className:"relative",children:[(0,Gt.jsx)("textarea",{value:j,onChange:e=>S(e.target.value),placeholder:"Tapez votre message...",className:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-purple-500 dark:bg-gray-600 dark:text-white h-20 resize-none pr-12",required:!0,maxLength:1e3,disabled:g,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||g||(e.preventDefault(),L(e))}}),(0,Gt.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs "+(j.length>900?"text-red-500":j.length>800?"text-yellow-500":"text-gray-400 dark:text-gray-500"),children:[j.length,"/1000"]})]}),(0,Gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Gt.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:"\ud83d\udca1 Appuyez sur Entr\xe9e pour envoyer \u2022 Shift+Entr\xe9e pour saut de ligne"}),(0,Gt.jsx)("button",{type:"submit",className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",disabled:!j.trim()||g,children:g?(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,Gt.jsx)("span",{children:"Envoi..."})]}):(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,Gt.jsx)("span",{children:"Envoyer"})]})})]})]})})]})]}),(0,Gt.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-dark-text",children:"Fichiers joints"}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsx)("input",{type:"file",id:"fileUpload",className:"hidden",accept:".jpg,.jpeg,.png,.gif,.pdf,.wav,.txt,.doc,.docx",onChange:async e=>{const r=e.target.files[0];if(!r)return;if(r.size>10485760)return void k("Fichier trop volumineux (limite: 10MB)");if(["image/jpeg","image/png","image/gif","image/webp","application/pdf","audio/wav","audio/wave","audio/x-wav","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(r.type)){x(!0);try{const n=await new Promise((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result.split(",")[1]),n.onerror=t,n.readAsDataURL(r)}),a={portabiliteId:t,nom_fichier:r.name,type_fichier:r.type,taille_fichier:r.size,contenu_base64:n};await o.post("/api/portabilite-fichiers",a),D(),R(),e.target.value=""}catch(w){var n,a;k((null===(n=w.response)||void 0===n||null===(a=n.data)||void 0===a?void 0:a.error)||"Erreur lors de l'upload du fichier")}finally{x(!1)}}else k("Type de fichier non autoris\xe9. Formats accept\xe9s: Images, PDF, WAV, TXT, DOC")},disabled:b}),(0,Gt.jsx)("label",{htmlFor:"fileUpload",className:"text-sm px-3 py-1 rounded border transition-colors cursor-pointer "+(b?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-primary-500 text-white hover:bg-primary-600 border-primary-500"),children:b?"Upload...":"+ Ajouter un fichier"})]})]}),m?(0,Gt.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary-600"})}):d.length>0?(0,Gt.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:d.map(e=>{return(0,Gt.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 dark:bg-dark-card rounded border",children:[(0,Gt.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,Gt.jsx)("span",{className:"text-lg",children:(r=e.type_fichier,r.startsWith("image/")?"\ud83d\uddbc\ufe0f":"application/pdf"===r?"\ud83d\udcc4":r.startsWith("audio/")?"\ud83c\udfb5":"text/plain"===r?"\ud83d\udcdd":r.includes("word")||r.includes("document")?"\ud83d\udcc4":"\ud83d\udcce")}),(0,Gt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-dark-text truncate",children:e.nom_fichier}),(0,Gt.jsxs)("p",{className:"text-xs text-gray-500 dark:text-dark-muted",children:[I(e.taille_fichier)," \u2022 ",e.uploaded_by_name," \u2022 ",fP(new Date(e.uploaded_at),"dd/MM/yyyy HH:mm",{locale:wP})]})]})]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,Gt.jsx)("button",{onClick:()=>(e=>{try{const t=atob(e.contenu_base64),r=new Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);const n=new Uint8Array(r),a=new Blob([n],{type:e.type_fichier}),i=window.URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download=e.nom_fichier,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(i)}catch(w){k("Erreur lors du t\xe9l\xe9chargement du fichier"),console.error("Download error:",w)}})(e),className:"p-1 text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300",title:"T\xe9l\xe9charger",children:(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),("agent"===i.type_utilisateur||"demandeur"===i.type_utilisateur)&&(0,Gt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer ce fichier ?"))try{await o.delete(`/api/portabilite-fichiers?portabiliteId=${t}&fileId=${e}`),D(),R()}catch(w){var r,n;k((null===(r=w.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.error)||"Erreur lors de la suppression du fichier")}})(e.id),className:"p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",title:"Supprimer",children:(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id);var r})}):(0,Gt.jsx)("p",{className:"text-sm text-gray-500 dark:text-dark-muted italic py-2",children:"Aucun fichier joint pour le moment"})]})]})}),N&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 max-w-md w-full mx-4",children:[(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Changer le statut"}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouveau statut"}),(0,Gt.jsx)("select",{value:E,onChange:e=>P(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white",children:Object.entries(T).map(e=>{let[t,r]=e;return(0,Gt.jsx)("option",{value:t,children:r},t)})})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Gt.jsx)("button",{onClick:()=>O(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Annuler"}),(0,Gt.jsx)("button",{onClick:async()=>{if(E){C(!0);try{const e=await o.put(`/api/portabilites/${t}`,{status:E});s(e.data),O(!1),P("")}catch(e){k("Erreur lors du changement de statut"),console.error("Erreur:",e)}finally{C(!1)}}},disabled:_,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md disabled:opacity-50 transition-colors",children:_?"Sauvegarde...":"Confirmer"})]})]})]})}),w&&(0,Gt.jsx)("div",{className:"mx-6 mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md",children:w})]})}):(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 max-w-md w-full mx-4",children:[(0,Gt.jsx)("p",{className:"text-red-600 text-center",children:"Portabilit\xe9 non trouv\xe9e"}),(0,Gt.jsx)("button",{onClick:r,className:"mt-4 w-full text-purple-600 hover:text-purple-800",children:"Fermer"})]})});var z},SP=e=>{let{onNavigate:t,onSelectPortabilite:r}=e;const[n,i]=(0,a.useState)([]),[o,l]=(0,a.useState)([]),[s,c]=(0,a.useState)(!0),[u,d]=(0,a.useState)(!1),[f,p]=(0,a.useState)(!0),[h,m]=(0,a.useState)(null),[y,g]=(0,a.useState)(1),[v,b]=(0,a.useState)(1),[x,w]=(0,a.useState)({status:"",client:"",search:""}),[k,j]=(0,a.useState)(null),[S,N]=(0,a.useState)(null),[O,E]=(0,a.useState)(!1),{user:P,api:_}=(0,a.useContext)(Xt),C={nouveau:"Nouveau",bloque:"Bloqu\xe9",rejete:"Rejet\xe9",en_cours:"En cours",demande:"Demand\xe9",valide:"Valid\xe9",termine:"Termin\xe9"},A={nouveau:"bg-blue-100 text-blue-800",bloque:"bg-red-100 text-red-800",rejete:"bg-red-100 text-red-800",en_cours:"bg-yellow-100 text-yellow-800",demande:"bg-orange-100 text-orange-800",valide:"bg-green-100 text-green-800",termine:"bg-gray-100 text-gray-800"},T=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x;try{f?c(!0):d(!0);const r=new URLSearchParams({page:e.toString(),limit:"10"});t.status&&r.append("status",t.status),t.client&&r.append("client",t.client),t.search&&r.append("search",t.search);const n=await _.get(`/api/portabilites?${r}`);n.data.data?(i(n.data.data),b(n.data.pagination.pages)):i(n.data)}catch(a){var r,n;console.error("Erreur lors du chargement des portabilit\xe9s:",a),401===(null===(r=a.response)||void 0===r?void 0:r.status)||404===(null===(n=a.response)||void 0===n?void 0:n.status)?m("Les tables de portabilit\xe9s ne sont pas encore cr\xe9\xe9es. Veuillez ex\xe9cuter le script SQL fourni dans votre base de donn\xe9es Neon."):m("Erreur lors du chargement des portabilit\xe9s")}finally{c(!1),d(!1),p(!1)}},M=e=>{if(!e.nom_societe)return"Client sans nom";let t=e.nom_societe;return e.nom&&e.prenom?t+=` (${e.nom} ${e.prenom})`:e.nom?t+=` (${e.nom})`:e.prenom&&(t+=` (${e.prenom})`),t},D=Array.isArray(o)?o.map(e=>({value:e.id,label:M(e)})):[],I=(e,t)=>{const r={...x,[e]:t};w(r),g(1),"search"===e?(k&&clearTimeout(k),j(setTimeout(()=>{T(1,r)},1e3))):T(1,r)},R=e=>{if(!e)return!1;const t=new Date;return new Date(e).toDateString()===t.toDateString()},L=e=>{N(e),E(!0)},z=()=>{T(y)};a.useEffect(()=>(window.refreshPortabilites=z,()=>{delete window.refreshPortabilites}),[y]);return(0,a.useEffect)(()=>{T(),(async()=>{try{const e=await _.get("/api/clients?limit=100");let t=e.data;e.data.data&&Array.isArray(e.data.data)&&(t=e.data.data),l(Array.isArray(t)?t:[])}catch(e){console.error("Erreur lors du chargement des clients:",e)}})()},[]),(0,a.useEffect)(()=>()=>{k&&clearTimeout(k)},[k]),s&&f?(0,Gt.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):(0,Gt.jsxs)("div",{className:"fade-in",children:[(0,Gt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,Gt.jsxs)("div",{className:"mb-8",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,Gt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Portabilit\xe9s"}),(0,Gt.jsx)("button",{onClick:()=>{t("portabilites-nouvelle")},className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"\ud83d\udcde Nouvelle Portabilit\xe9"})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Statut"}),(0,Gt.jsxs)("select",{value:x.status,onChange:e=>I("status",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white",children:[(0,Gt.jsx)("option",{value:"",children:"Tous les statuts"}),Object.entries(C).map(e=>{let[t,r]=e;return(0,Gt.jsx)("option",{value:t,children:r},t)})]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Client"}),(0,Gt.jsx)(lE,{options:D,value:x.client,onChange:e=>I("client",e),placeholder:"Rechercher un client...",className:"w-full"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Num\xe9ro de portabilit\xe9"}),(0,Gt.jsx)("input",{type:"text",value:x.search,onChange:e=>I("search",e.target.value),placeholder:"Rechercher par num\xe9ro...",className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white"})]})]})]}),(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md",children:[(0,Gt.jsx)("div",{className:"overflow-x-auto",children:(0,Gt.jsxs)("table",{className:"w-full table-auto",children:[(0,Gt.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,Gt.jsxs)("tr",{children:[(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Num\xe9ro"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Client"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Statut"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date demand\xe9e"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date effective"}),(0,Gt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,Gt.jsx)("tbody",{className:"bg-white dark:bg-dark-surface divide-y divide-gray-200 dark:divide-gray-700",children:u?(0,Gt.jsx)("tr",{children:(0,Gt.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center",children:(0,Gt.jsx)("div",{className:"flex justify-center",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"})})})}):0===n.length?(0,Gt.jsx)("tr",{children:(0,Gt.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:x.status||x.client||x.search?"Aucune portabilit\xe9 trouv\xe9e avec ces filtres":"Aucune portabilit\xe9 trouv\xe9e"})}):n.map(e=>(0,Gt.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors "+(R(e.date_portabilite_effective)?"bg-red-50 dark:bg-red-900/20":""),onClick:()=>L(e.id),children:[(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsxs)("span",{className:"text-sm font-medium text-gray-900 dark:text-dark-text",children:["#",e.numero_portabilite]}),R(e.date_portabilite_effective)&&(0,Gt.jsx)("span",{className:"ml-2 text-red-500",children:"\ud83d\udea8"})]})}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Gt.jsx)("div",{className:"text-sm text-gray-900 dark:text-dark-text",children:e.client_display||e.nom_societe})}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,Gt.jsx)("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${A[e.status]||"bg-gray-100 text-gray-800"}`,children:C[e.status]||e.status})}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-dark-text",children:e.date_portabilite_demandee?new Date(e.date_portabilite_demandee).toLocaleDateString("fr-FR"):"-"}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-dark-text",children:e.date_portabilite_effective?new Date(e.date_portabilite_effective).toLocaleDateString("fr-FR"):"-"}),(0,Gt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsx)("button",{onClick:t=>{t.stopPropagation(),L(e.id)},className:"text-purple-600 hover:text-purple-900 dark:text-purple-400 dark:hover:text-purple-300",children:"Voir d\xe9tails"}),"agent"===P.type_utilisateur&&(0,Gt.jsx)("button",{onClick:t=>{t.stopPropagation(),(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette portabilit\xe9 ?"))try{await _.delete(`/api/portabilites/${e}`),T(y)}catch(t){m("Erreur lors de la suppression"),console.error("Erreur:",t)}})(e.id)},className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 ml-4",title:"Supprimer",children:(0,Gt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id))})]})}),v>1&&(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6",children:(0,Gt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Gt.jsx)("div",{children:(0,Gt.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",y," sur ",v]})}),(0,Gt.jsxs)("div",{className:"flex space-x-2",children:[(0,Gt.jsx)("button",{onClick:()=>{y>1&&(g(y-1),T(y-1))},disabled:1===y,className:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Pr\xe9c\xe9dent"}),(0,Gt.jsx)("button",{onClick:()=>{y<v&&(g(y+1),T(y+1))},disabled:y===v,className:"px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Suivant"})]})]})})]}),h&&(0,Gt.jsx)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded-md mb-6",children:(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,Gt.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,Gt.jsxs)("div",{className:"ml-3",children:[(0,Gt.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Configuration requise"}),(0,Gt.jsxs)("div",{className:"mt-2 text-sm text-yellow-700",children:[(0,Gt.jsx)("p",{children:h}),(0,Gt.jsxs)("p",{className:"mt-2",children:[(0,Gt.jsx)("strong",{children:"Instructions :"})," Copiez le contenu du fichier",(0,Gt.jsx)("code",{className:"mx-1 px-2 py-1 bg-yellow-200 rounded text-xs",children:"/app/create_portabilites_structure.sql"}),"et ex\xe9cutez-le dans votre base de donn\xe9es Neon."]})]})]})]})})]}),O&&S&&(0,Gt.jsx)(jP,{portabiliteId:S,onClose:()=>{E(!1),N(null)},onEdit:e=>{r(e),t("portabilites-edit")}})]})},NP=e=>{let{onNavigate:t,portabiliteId:r}=e;const n=Boolean(r),{user:i,api:o}=(0,a.useContext)(Xt),[l,s]=(0,a.useState)(!1),[c,u]=(0,a.useState)([]),[d,f]=(0,a.useState)([]),[p,h]=(0,a.useState)(null),[m,y]=(0,a.useState)(!1),[g,v]=(0,a.useState)(1),[b,x]=(0,a.useState)({client_id:"",demandeur_id:"",numeros_portes:"",nom_client:"",prenom_client:"",email_client:"",siret_client:"",adresse:"",code_postal:"",ville:"",date_portabilite_demandee:"",date_portabilite_effective:"",fiabilisation_demandee:!1,demande_signee:!1}),[w,k]=(0,a.useState)({loading:!1,error:null,success:!1}),[j,S]=(0,a.useState)({}),N=e=>{if(!e.nom_societe)return"Client sans nom";let t=e.nom_societe;return e.nom&&e.prenom?t+=` (${e.nom} ${e.prenom})`:e.nom?t+=` (${e.nom})`:e.prenom&&(t+=` (${e.prenom})`),t},O=Array.isArray(c)?c.map(e=>({value:e.id,label:N(e)})):[],E=Array.isArray(d)?d.map(e=>({value:e.id,label:`${e.prenom} ${e.nom} (${e.email})`})):[],P=e=>{const{name:t,value:r,type:n,checked:a}=e.target;if(j[t]&&S(e=>{const r={...e};return delete r[t],r}),"siret_client"===t){const e=(e=>e.replace(/[\s\.]/g,"").replace(/[^\d]/g,""))(r),n=e.slice(0,14);x(e=>({...e,[t]:n})),14===n.length?(async e=>{if(e&&14===e.length){k({loading:!0,error:null,success:!1});try{const t=(await o.get(`/api/insee-api?siret=${e}`)).data;x(e=>({...e,adresse:t.adresse.adresseComplete||"",code_postal:t.adresse.codePostal||"",ville:t.adresse.commune||""})),k({loading:!1,error:null,success:!0})}catch(p){var t,r;const n=(null===(t=p.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.error)||"Erreur lors de la r\xe9cup\xe9ration des donn\xe9es INSEE";k({loading:!1,error:n,success:!1})}}})(n):k({loading:!1,error:null,success:!1})}else x(e=>({...e,[t]:"checkbox"===n?a:r}))};(0,a.useEffect)(()=>{(async()=>{await(async()=>{try{const e=await o.get("/api/clients?limit=100");let t=e.data;e.data.data&&Array.isArray(e.data.data)&&(t=e.data.data),u(Array.isArray(t)?t:[])}catch(e){console.error("Erreur lors du chargement des clients:",e)}})(),await(async()=>{if("agent"===i.type_utilisateur)try{const e=await o.get("/api/demandeurs");f(Array.isArray(e.data)?e.data:[]),console.log("Demandeurs charg\xe9s:",e.data)}catch(e){console.error("Erreur lors du chargement des demandeurs:",e)}})(),await(async()=>{if(n)try{s(!0);const e=(await o.get(`/api/portabilites/${r}`)).data;x({client_id:e.client_id||"",demandeur_id:e.demandeur_id||"",numeros_portes:e.numeros_portes||"",nom_client:e.nom_client||"",prenom_client:e.prenom_client||"",email_client:e.email_client||"",siret_client:e.siret_client||"",adresse:e.adresse||"",code_postal:e.code_postal||"",ville:e.ville||"",date_portabilite_demandee:e.date_portabilite_demandee?e.date_portabilite_demandee.split("T")[0]:"",date_portabilite_effective:e.date_portabilite_effective?e.date_portabilite_effective.split("T")[0]:"",fiabilisation_demandee:e.fiabilisation_demandee||!1,demande_signee:e.demande_signee||!1})}catch(e){h("Erreur lors du chargement de la portabilit\xe9"),console.error("Erreur:",e)}finally{s(!1)}})(),i&&"demandeur"===i.type_utilisateur&&!n&&x(e=>({...e,demandeur_id:i.id}))})()},[i,n,r]);return l&&n?(0,Gt.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500"})}):(0,Gt.jsx)("div",{className:"p-6 bg-gray-50 dark:bg-dark-bg min-h-screen",children:(0,Gt.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md p-8",children:[(0,Gt.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,Gt.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:n?"Modifier la portabilit\xe9":"Nouvelle portabilit\xe9"}),(0,Gt.jsxs)("button",{onClick:()=>t("portabilites"),className:"text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200 flex items-center space-x-2",children:[(0,Gt.jsx)("span",{children:"\u2190"}),(0,Gt.jsx)("span",{children:"Retour"})]})]}),p&&(0,Gt.jsx)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md",children:p}),m&&(0,Gt.jsxs)("div",{className:"mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-md",children:["Portabilit\xe9 ",n?"modifi\xe9e":"cr\xe9\xe9e"," avec succ\xe8s ! Redirection en cours..."]}),(0,Gt.jsxs)("div",{className:"mb-8",children:[(0,Gt.jsx)("div",{className:"flex items-center justify-between mb-4",children:[1,2,3].map(e=>(0,Gt.jsxs)("div",{className:"flex items-center",children:[(0,Gt.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold cursor-pointer transition-colors "+(e===g?"bg-purple-600 text-white":e<g?"bg-green-500 text-white":"bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-400"),onClick:()=>(e=>{v(e)})(e),children:e<g?"\u2713":e}),e<3&&(0,Gt.jsx)("div",{className:"w-20 h-1 mx-4 "+(e<g?"bg-green-500":"bg-gray-200 dark:bg-gray-700")})]},e))}),(0,Gt.jsx)("div",{className:"text-center",children:(0,Gt.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["\xc9tape ",g," sur 3"]})})]}),(0,Gt.jsxs)("form",{className:"space-y-8",children:[1===g&&(0,Gt.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[(0,Gt.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[(0,Gt.jsx)("span",{className:"bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-300 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:"1"}),"Choix du client"]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Client *"}),(0,Gt.jsx)(lE,{options:O,value:b.client_id,onChange:e=>{x(t=>({...t,client_id:e})),j.client_id&&S(e=>{const t={...e};return delete t.client_id,t})},placeholder:"S\xe9lectionner un client...",required:!0,hasError:j.client_id})]}),"agent"===i.type_utilisateur&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Demandeur *"}),(0,Gt.jsx)(lE,{options:E,value:b.demandeur_id,onChange:e=>{x(t=>({...t,demandeur_id:e})),j.demandeur_id&&S(e=>{const t={...e};return delete t.demandeur_id,t})},placeholder:"S\xe9lectionner un demandeur...",required:!0,hasError:j.demandeur_id})]})]})]}),2===g&&(0,Gt.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-6",children:[(0,Gt.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[(0,Gt.jsx)("span",{className:"bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:"2"}),"Donn\xe9es du client"]}),(0,Gt.jsxs)("div",{className:"mb-6",children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"SIRET client *"}),(0,Gt.jsxs)("div",{className:"relative flex items-center",children:[(0,Gt.jsx)("input",{type:"text",name:"siret_client",value:b.siret_client,onChange:P,placeholder:"14 chiffres (espaces et points supprim\xe9s automatiquement)",maxLength:"14",required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.siret_client?"border-red-500":"border-gray-300")}),(0,Gt.jsxs)("div",{className:"ml-3 flex items-center",children:[w.loading&&(0,Gt.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,Gt.jsx)("span",{className:"text-sm",children:"V\xe9rification..."})]}),w.success&&(0,Gt.jsxs)("div",{className:"flex items-center text-green-600",children:[(0,Gt.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,Gt.jsx)("span",{className:"text-sm",children:"Donn\xe9es r\xe9cup\xe9r\xe9es"})]}),w.error&&(0,Gt.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,Gt.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,Gt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,Gt.jsx)("span",{className:"text-sm",children:w.error})]})]})]}),(0,Gt.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Les donn\xe9es d'adresse seront automatiquement remplies si le SIRET est trouv\xe9"})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nom client *"}),(0,Gt.jsx)("input",{type:"text",name:"nom_client",value:b.nom_client,onChange:P,required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.nom_client?"border-red-500":"border-gray-300")})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pr\xe9nom client *"}),(0,Gt.jsx)("input",{type:"text",name:"prenom_client",value:b.prenom_client,onChange:P,required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.prenom_client?"border-red-500":"border-gray-300")})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email client"}),(0,Gt.jsx)("input",{type:"email",name:"email_client",value:b.email_client,onChange:P,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white"})]})]}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Adresse *",w.success&&(0,Gt.jsx)("span",{className:"text-green-600 text-xs ml-2",children:"(remplie automatiquement)"})]}),(0,Gt.jsx)("input",{type:"text",name:"adresse",value:b.adresse,onChange:P,placeholder:"Adresse sera remplie automatiquement avec le SIRET",required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.adresse?"border-red-500":"border-gray-300")})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Code postal *",w.success&&(0,Gt.jsx)("span",{className:"text-green-600 text-xs ml-2",children:"(rempli automatiquement)"})]}),(0,Gt.jsx)("input",{type:"text",name:"code_postal",value:b.code_postal,onChange:P,placeholder:"Code postal sera rempli automatiquement",required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.code_postal?"border-red-500":"border-gray-300")})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Ville *",w.success&&(0,Gt.jsx)("span",{className:"text-green-600 text-xs ml-2",children:"(remplie automatiquement)"})]}),(0,Gt.jsx)("input",{type:"text",name:"ville",value:b.ville,onChange:P,placeholder:"Ville sera remplie automatiquement",required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.ville?"border-red-500":"border-gray-300")})]})]})]})]}),3===g&&(0,Gt.jsxs)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-6",children:[(0,Gt.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center",children:[(0,Gt.jsx)("span",{className:"bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3",children:"3"}),"Informations de portabilit\xe9"]}),(0,Gt.jsxs)("div",{className:"mb-6",children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Num\xe9ros \xe0 porter *"}),(0,Gt.jsx)("textarea",{name:"numeros_portes",value:b.numeros_portes,onChange:P,required:!0,rows:"4",placeholder:"Saisir les num\xe9ros \xe0 porter (un par ligne ou s\xe9par\xe9s par des virgules)",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.numeros_portes?"border-red-500":"border-gray-300")})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date de portabilit\xe9 demand\xe9e *"}),(0,Gt.jsx)("input",{type:"date",name:"date_portabilite_demandee",value:b.date_portabilite_demandee,onChange:P,required:!0,className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white "+(j.date_portabilite_demandee?"border-red-500":"border-gray-300")})]}),n&&"agent"===i.type_utilisateur&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Date de portabilit\xe9 effective"}),(0,Gt.jsx)("input",{type:"date",name:"date_portabilite_effective",value:b.date_portabilite_effective,onChange:P,className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white"})]})]}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,Gt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Gt.jsx)("input",{type:"checkbox",name:"fiabilisation_demandee",checked:b.fiabilisation_demandee,onChange:P,className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),(0,Gt.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Fiabilisation demand\xe9e"})]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Gt.jsx)("input",{type:"checkbox",name:"demande_signee",checked:b.demande_signee,onChange:P,className:"h-5 w-5 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),(0,Gt.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Demande de portabilit\xe9 sign\xe9e"})]})]}),(0,Gt.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,Gt.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Gt.jsx)("div",{className:"flex-shrink-0",children:(0,Gt.jsx)("span",{className:"text-blue-500 text-lg",children:"\ud83d\udca1"})}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("h4",{className:"text-sm font-medium text-blue-800 dark:text-blue-300",children:"Ajout de fichiers"}),(0,Gt.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-400 mt-1",children:'Les fichiers peuvent \xeatre ajout\xe9s apr\xe8s la cr\xe9ation de la portabilit\xe9 dans la section "D\xe9tails".'})]})]})})]}),(0,Gt.jsxs)("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,Gt.jsxs)("div",{className:"flex space-x-4",children:[(0,Gt.jsx)("button",{type:"button",onClick:()=>t("portabilites"),className:"px-6 py-3 border border-gray-300 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors font-medium",children:"Annuler"}),g>1&&(0,Gt.jsx)("button",{type:"button",onClick:()=>{g>1&&v(g-1)},className:"px-6 py-3 border border-purple-300 text-purple-600 rounded-md hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-colors font-medium",children:"Pr\xe9c\xe9dent"})]}),(0,Gt.jsx)("div",{className:"flex space-x-4",children:g<3?(0,Gt.jsx)("button",{type:"button",onClick:()=>{const e=(e=>{const t=[],r={};switch(e){case 1:b.client_id||(t.push("Veuillez s\xe9lectionner un client"),r.client_id=!0),"agent"!==i.type_utilisateur||b.demandeur_id||(t.push("Veuillez s\xe9lectionner un demandeur"),r.demandeur_id=!0);break;case 2:b.siret_client.trim()||(t.push("Le SIRET client est obligatoire"),r.siret_client=!0),b.nom_client.trim()||(t.push("Le nom client est obligatoire"),r.nom_client=!0),b.prenom_client.trim()||(t.push("Le pr\xe9nom client est obligatoire"),r.prenom_client=!0),b.adresse.trim()||(t.push("L'adresse est obligatoire"),r.adresse=!0),b.code_postal.trim()||(t.push("Le code postal est obligatoire"),r.code_postal=!0),b.ville.trim()||(t.push("La ville est obligatoire"),r.ville=!0);break;case 3:b.numeros_portes.trim()||(t.push("Les num\xe9ros \xe0 porter sont obligatoires"),r.numeros_portes=!0),b.date_portabilite_demandee||(t.push("La date de portabilit\xe9 demand\xe9e est obligatoire"),r.date_portabilite_demandee=!0)}return S(r),t})(g);e.length>0?h(e.join(", ")):(h(null),g<3&&v(g+1))},className:"px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors font-medium",children:"Suivant"}):(0,Gt.jsxs)("button",{type:"button",onClick:async e=>{if(e&&e.preventDefault(),s(!0),h(null),!b.client_id||!b.numeros_portes.trim())return h("Veuillez s\xe9lectionner un client et saisir les num\xe9ros \xe0 porter"),void s(!1);if("agent"===i.type_utilisateur&&!b.demandeur_id)return h("Veuillez s\xe9lectionner un demandeur"),void s(!1);try{const e={...b};n||e.date_portabilite_effective||delete e.date_portabilite_effective,n?await o.put(`/api/portabilites/${r}`,e):await o.post("/api/portabilites",e),y(!0),setTimeout(()=>{t("portabilites")},1500)}catch(c){var a,l;h((null===(a=c.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.error)||"Erreur lors de la sauvegarde"),console.error("Erreur:",c)}finally{s(!1)}},disabled:l,className:"px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 transition-colors font-medium flex items-center space-x-2",children:[l&&(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),(0,Gt.jsx)("span",{children:l?"Sauvegarde...":n?"Modifier":"Cr\xe9er"})]})})]})]})]})})})},OP=e=>{let{portabiliteId:t,onNavigate:r}=e;const{user:n,api:i}=(0,a.useContext)(Xt),[o,l]=(0,a.useState)(null),[s,c]=(0,a.useState)([]),[u,d]=(0,a.useState)(!0),[f,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[y,g]=(0,a.useState)(""),[v,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)(""),[k,j]=(0,a.useState)(!1),S=(0,a.useRef)(null),N={nouveau:"Nouveau",bloque:"Bloqu\xe9",rejete:"Rejet\xe9",en_cours:"En cours",demande:"Demand\xe9",valide:"Valid\xe9",termine:"Termin\xe9"},O=async()=>{try{const e=await i.get(`/api/portabilites/${t}`);l(e.data)}catch(e){m("Erreur lors du chargement de la portabilit\xe9"),console.error("Erreur:",e)}},E=async()=>{try{const e=await i.get(`/api/portabilite-echanges?portabiliteId=${t}`);c(e.data)}catch(e){console.error("Erreur lors du chargement des commentaires:",e)}},P=e=>e?new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return(0,a.useEffect)(()=>{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]),(0,a.useEffect)(()=>{(async()=>{d(!0),await Promise.all([O(),E()]),d(!1)})()},[t]),u?(0,Gt.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500"})}):o?(0,Gt.jsx)("div",{className:"p-6 bg-gray-50 dark:bg-dark-bg min-h-screen",children:(0,Gt.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,Gt.jsx)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md p-6 mb-6",children:(0,Gt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:["Portabilit\xe9 #",o.numero_portabilite]}),(0,Gt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Gt.jsx)("span",{className:`px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full ${{nouveau:"bg-blue-100 text-blue-800",bloque:"bg-red-100 text-red-800",rejete:"bg-red-100 text-red-800",en_cours:"bg-yellow-100 text-yellow-800",demande:"bg-orange-100 text-orange-800",valide:"bg-green-100 text-green-800",termine:"bg-gray-100 text-gray-800"}[o.status]||"bg-gray-100 text-gray-800"}`,children:N[o.status]||o.status}),(e=>{if(!e)return!1;const t=new Date;return new Date(e).toDateString()===t.toDateString()})(o.date_portabilite_effective)&&(0,Gt.jsx)("span",{className:"text-red-500 font-semibold",children:"\ud83d\udea8 Portabilit\xe9 effective aujourd'hui"})]})]}),(0,Gt.jsxs)("div",{className:"flex space-x-2",children:["agent"===n.type_utilisateur&&(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("button",{onClick:()=>r("portabilites-edit"),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Modifier"}),(0,Gt.jsx)("button",{onClick:()=>{w(o.status),b(!0)},className:"bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Changer statut"}),(0,Gt.jsx)("button",{onClick:async()=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cette portabilit\xe9 ?"))try{await i.delete(`/api/portabilites/${t}`),r("portabilites")}catch(e){m("Erreur lors de la suppression"),console.error("Erreur:",e)}},className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Supprimer"})]}),(0,Gt.jsx)("button",{onClick:()=>r("portabilites"),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors",children:"\u2190 Retour"})]})]})}),(0,Gt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md p-6",children:[(0,Gt.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:"Informations g\xe9n\xe9rales"}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Client"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:o.nom_societe})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Demandeur"}),(0,Gt.jsxs)("p",{className:"text-gray-900 dark:text-white",children:[o.demandeur_prenom," ",o.demandeur_nom]})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date de cr\xe9ation"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:P(o.date_creation)})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date souhait\xe9e"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:o.date_portabilite_demandee?new Date(o.date_portabilite_demandee).toLocaleDateString("fr-FR"):"-"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Date effective"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:o.date_portabilite_effective?new Date(o.date_portabilite_effective).toLocaleDateString("fr-FR"):"-"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Num\xe9ros \xe0 porter"}),(0,Gt.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-md",children:(0,Gt.jsx)("pre",{className:"text-sm text-gray-900 dark:text-white whitespace-pre-wrap",children:o.numeros_portes})})]}),o.adresse&&(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Adresse"}),(0,Gt.jsxs)("p",{className:"text-gray-900 dark:text-white",children:[o.adresse,o.code_postal&&`, ${o.code_postal}`,o.ville&&` ${o.ville}`]})]}),(0,Gt.jsxs)("div",{className:"flex space-x-6",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Fiabilisation"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:o.fiabilisation_demandee?"\u2705 Oui":"\u274c Non"})]}),(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Demande sign\xe9e"}),(0,Gt.jsx)("p",{className:"text-gray-900 dark:text-white",children:o.demande_signee?"\u2705 Oui":"\u274c Non"})]})]})]})]}),(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md p-6",children:[(0,Gt.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["Commentaires (",s.length,")"]}),(0,Gt.jsxs)("div",{className:"h-80 overflow-y-auto mb-4 space-y-3 border rounded-lg p-4 bg-gray-50 dark:bg-gray-800",children:[0===s.length?(0,Gt.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"Aucun commentaire pour le moment"}):s.map(e=>(0,Gt.jsxs)("div",{className:"p-3 rounded-lg border-l-4 "+("agent"===e.auteur_type?"bg-blue-50 dark:bg-blue-900/20 border-blue-500":"bg-green-50 dark:bg-green-900/20 border-green-500"),children:[(0,Gt.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Gt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Gt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold "+("agent"===e.auteur_type?"bg-blue-500":"bg-green-500"),children:e.auteur_nom?e.auteur_nom.split(" ").map(e=>e[0]).join(""):"A"}),(0,Gt.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.auteur_nom||"Utilisateur"})]}),(0,Gt.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:P(e.created_at)})]}),(0,Gt.jsx)("p",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:e.message})]},e.id)),(0,Gt.jsx)("div",{ref:S})]}),(0,Gt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),y.trim()){p(!0);try{const e=await i.post("/api/portabilite-echanges",{portabiliteId:t,message:y.trim()});c([...s,e.data]),g(""),setTimeout(()=>{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},100)}catch(r){m("Erreur lors de l'envoi du commentaire"),console.error("Erreur:",r)}finally{p(!1)}}},className:"space-y-3",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("textarea",{value:y,onChange:e=>g(e.target.value),placeholder:"Ajouter un commentaire...",rows:"3",className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white",disabled:f}),(0,Gt.jsx)("div",{className:"flex justify-between items-center mt-2",children:(0,Gt.jsxs)("span",{className:"text-sm "+(y.length>800?"text-red-500":y.length>700?"text-yellow-500":"text-gray-500"),children:[y.length,"/1000 caract\xe8res"]})})]}),(0,Gt.jsx)("button",{type:"submit",disabled:f||!y.trim()||y.length>1e3,className:"w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-md font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:f?(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),(0,Gt.jsx)("span",{children:"Envoi..."})]}):(0,Gt.jsxs)(Gt.Fragment,{children:[(0,Gt.jsx)("span",{children:"Envoyer"}),(0,Gt.jsx)("span",{children:"\ud83d\udce9"})]})})]})]})]}),v&&(0,Gt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg p-6 max-w-md w-full mx-4",children:[(0,Gt.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Changer le statut"}),(0,Gt.jsxs)("div",{className:"space-y-4",children:[(0,Gt.jsxs)("div",{children:[(0,Gt.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouveau statut"}),(0,Gt.jsx)("select",{value:x,onChange:e=>w(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-dark-surface dark:border-gray-600 dark:text-white",children:Object.entries(N).map(e=>{let[t,r]=e;return(0,Gt.jsx)("option",{value:t,children:r},t)})})]}),(0,Gt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,Gt.jsx)("button",{onClick:()=>b(!1),className:"px-4 py-2 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:"Annuler"}),(0,Gt.jsx)("button",{onClick:async()=>{if(x){j(!0);try{const e=await i.put(`/api/portabilites/${t}`,{status:x});l(e.data),b(!1),w("")}catch(e){m("Erreur lors du changement de statut"),console.error("Erreur:",e)}finally{j(!1)}}},disabled:k,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md disabled:opacity-50 transition-colors",children:k?"Sauvegarde...":"Confirmer"})]})]})]})}),h&&(0,Gt.jsx)("div",{className:"mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-md",children:h})]})}):(0,Gt.jsx)("div",{className:"p-6 bg-gray-50 dark:bg-dark-bg min-h-screen",children:(0,Gt.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,Gt.jsxs)("div",{className:"bg-white dark:bg-dark-surface rounded-lg shadow-md p-6",children:[(0,Gt.jsx)("p",{className:"text-red-600",children:"Portabilit\xe9 non trouv\xe9e"}),(0,Gt.jsx)("button",{onClick:()=>r("portabilites"),className:"mt-4 text-purple-600 hover:text-purple-800",children:"\u2190 Retour aux portabilit\xe9s"})]})})})},EP=()=>{const{user:e,loading:t,isAuthenticated:r}=Qt(),[n,i]=(0,a.useState)("dashboard"),[o,l]=(0,a.useState)(null);if(t)return(0,Gt.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg flex items-center justify-center",children:(0,Gt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(!r)return(0,Gt.jsx)(br,{});return(0,Gt.jsx)(hr,{currentPage:n,onNavigate:i,children:(0,Gt.jsx)("div",{className:"flex-1",children:(()=>{switch(n){case"dashboard":default:return(0,Gt.jsx)(GO,{});case"clients":return(0,Gt.jsx)(aE,{});case"demandeurs":return(0,Gt.jsx)(sE,{});case"agents":return(0,Gt.jsx)(cE,{});case"portabilites":return(0,Gt.jsx)(SP,{onNavigate:i,onSelectPortabilite:l});case"portabilites-nouvelle":return(0,Gt.jsx)(NP,{onNavigate:i});case"portabilites-detail":return(0,Gt.jsx)(OP,{portabiliteId:o,onNavigate:i});case"portabilites-edit":return(0,Gt.jsx)(NP,{portabiliteId:o,onNavigate:i});case"tickets":return(0,Gt.jsx)(kP,{})}})()})})};const PP=function(){return(0,Gt.jsx)(P,{children:(0,Gt.jsx)(Zt,{children:(0,Gt.jsxs)("div",{className:"app-container bg-gray-100 dark:bg-dark-bg",children:[(0,Gt.jsx)("div",{className:"main-content",children:(0,Gt.jsx)(EP,{})}),(0,Gt.jsx)(kr,{})]})})})};o.createRoot(document.getElementById("root")).render((0,Gt.jsx)(a.StrictMode,{children:(0,Gt.jsx)(PP,{})}))})()})();
//# sourceMappingURL=main.bf5a1877.js.map